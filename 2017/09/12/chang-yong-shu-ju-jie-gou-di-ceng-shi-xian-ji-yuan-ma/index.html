<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"zhoudamin.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="ZDM–ArrayList、HashMap、Collection、LinkedList、Redis 底层实现及源码">
<meta property="og:type" content="article">
<meta property="og:title" content="常用数据结构底层实现及源码">
<meta property="og:url" content="http://zhoudamin.github.io/2017/09/12/chang-yong-shu-ju-jie-gou-di-ceng-shi-xian-ji-yuan-ma/index.html">
<meta property="og:site_name" content="Notes">
<meta property="og:description" content="ZDM–ArrayList、HashMap、Collection、LinkedList、Redis 底层实现及源码">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2017-09-12T01:59:40.000Z">
<meta property="article:modified_time" content="2018-04-23T02:27:20.062Z">
<meta property="article:author" content="Damin ZHOU">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="数据结构">
<meta property="article:tag" content="源码">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://zhoudamin.github.io/2017/09/12/chang-yong-shu-ju-jie-gou-di-ceng-shi-xian-ji-yuan-ma/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>常用数据结构底层实现及源码 | Notes</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Notes" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-hopscotch.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Notes</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Learn Practice Summary</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zhoudamin.github.io/2017/09/12/chang-yong-shu-ju-jie-gou-di-ceng-shi-xian-ji-yuan-ma/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Damin ZHOU">
      <meta itemprop="description" content="Goals determine <br/> what you are going to be .">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Notes">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          常用数据结构底层实现及源码
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-09-12 09:59:40" itemprop="dateCreated datePublished" datetime="2017-09-12T09:59:40+08:00">2017-09-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-04-23 10:27:20" itemprop="dateModified" datetime="2018-04-23T10:27:20+08:00">2018-04-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" itemprop="url" rel="index"><span itemprop="name">数据结构</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>ZDM–ArrayList、HashMap、Collection、LinkedList、Redis 底层实现及源码</p>
<a id="more"></a>

<h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><h2 id="Redis简介"><a href="#Redis简介" class="headerlink" title="Redis简介"></a>Redis简介</h2><p>Redis是一种key/value型数据库，其中，每个key和value都是使用对象表示的。</p>
<pre class=" language-java"><code class="language-java">SET message <span class="token string">"Hello"</span></code></pre>
<p>其中，字符串 “message” 这个对象 就是 key ， “Hello” 这个对象 就是 value</p>
<p>Redis有5种对象的类型</p>
<table>
<thead>
<tr>
<th align="center">类型常量</th>
<th align="center">小写</th>
<th align="center">对象名称</th>
</tr>
</thead>
<tbody><tr>
<td align="center">REDIS_STRING</td>
<td align="center">string</td>
<td align="center">字符串对象</td>
</tr>
<tr>
<td align="center">REDIS_LIST</td>
<td align="center">list</td>
<td align="center">列表对象</td>
</tr>
<tr>
<td align="center">REDIS_HASH</td>
<td align="center">hash</td>
<td align="center">哈希对象</td>
</tr>
<tr>
<td align="center">REDIS_SET</td>
<td align="center">set</td>
<td align="center">集合对象</td>
</tr>
<tr>
<td align="center">REDIS_ZSET</td>
<td align="center">zset</td>
<td align="center">有序集合对象</td>
</tr>
</tbody></table>
<p>Redis对象底层数据结构</p>
<table>
<thead>
<tr>
<th align="center">编码常量</th>
<th align="center">数据结构</th>
</tr>
</thead>
<tbody><tr>
<td align="center">int</td>
<td align="center">long类型的整数</td>
</tr>
<tr>
<td align="center">embstr</td>
<td align="center">embstr编码的简单动态字符串</td>
</tr>
<tr>
<td align="center">raw</td>
<td align="center">简单动态字符串</td>
</tr>
<tr>
<td align="center">ht</td>
<td align="center">字典</td>
</tr>
<tr>
<td align="center">linkedlist</td>
<td align="center">双端链表</td>
</tr>
<tr>
<td align="center">ziplist</td>
<td align="center">压缩列表</td>
</tr>
<tr>
<td align="center">intset</td>
<td align="center">整数集合</td>
</tr>
<tr>
<td align="center">skiplist</td>
<td align="center">跳跃表和字典</td>
</tr>
</tbody></table>
<hr>
<h2 id="字符串对象"><a href="#字符串对象" class="headerlink" title="字符串对象"></a>字符串对象</h2><p>字符串对象的编码可以是int、raw、embstr</p>
<p>如果字符串对象的长度小于39字节，就用embstr</p>
<p>否则用传统的raw对象</p>
<pre class=" language-jade"><code class="language-jade"># define REDIS_ENCODING_EMBSTR_SIZE_LIMIT 39  
<span class="token tag">robj</span> <span class="token plain-text">*createStringObject(char *ptr, size_t len) {  </span>
    <span class="token flow-control"><span class="token branch keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">&lt;=</span> REDIS_ENCODING_EMBSTR_SIZE_LIMIT<span class="token punctuation">)</span>  </span>
        <span class="token tag">return</span> <span class="token plain-text">createEmbeddedStringObject(ptr,len);  </span>
    <span class="token flow-control"><span class="token branch keyword">else</span>  </span>
        <span class="token tag">return</span> <span class="token plain-text">createRawStringObject(ptr,len);  </span>
}  </code></pre>
<p>embstr的优点：</p>
<ul>
<li>创建只需分配一次内存，raw为两次</li>
<li>释放内存也是一次</li>
<li>embstr的objet和sds放在一起，更好地利用缓存带来的优势</li>
</ul>
<hr>
<h2 id="列表对象"><a href="#列表对象" class="headerlink" title="列表对象"></a>列表对象</h2><p>列表对象的编码可以是 ziplist or LinkedList</p>
<p>ziplist 是一种压缩链表，好处是更能节省内存空间，存储的内容都是在连续的内存区域中的</p>
<p>LinkedList是一种双向链表，没增加一个node，都要重新分配一个内存</p>
<hr>
<h2 id="哈希对象"><a href="#哈希对象" class="headerlink" title="哈希对象"></a>哈希对象</h2><p>哈希对象的底层实现用ziplist or hashtable</p>
<p>ziplist : 对象数目不多且内容不大，这种方式效率很高</p>
<p>HashTable由dict这个结构实现</p>
<hr>
<h2 id="集合对象"><a href="#集合对象" class="headerlink" title="集合对象"></a>集合对象</h2><p>集合对象编码可以是 intset or HashTable</p>
<hr>
<h2 id="有序集合对象"><a href="#有序集合对象" class="headerlink" title="有序集合对象"></a>有序集合对象</h2><p>编码一种是 ziplist  ，一种是skipList 与 dict 的结合</p>
<p>ziplist作为集合和作为哈希对象是一样的，member和score顺序存放。按照score从小到大顺序排列。它的结构不再复述。</p>
<p>skiplist是一种跳跃表，它实现了有序集合中的快速查找，在大多数情况下它的速度都可以和平衡树差不多。但它的实现比较简单，可以作为平衡树的替代品。</p>
<hr>
<h1 id="ArrayList"><a href="#ArrayList" class="headerlink" title="ArrayList"></a>ArrayList</h1><p>ArrayList是基于数组实现的，是一个动态数组，其容量能自动增长(1.5+1)。</p>
<p>非线程安全</p>
<p>源码：</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> java<span class="token punctuation">.</span>util<span class="token punctuation">;</span>    

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span>E<span class="token operator">></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractList</span><span class="token operator">&lt;</span>E<span class="token operator">></span>    
        <span class="token keyword">implements</span> <span class="token class-name">List</span><span class="token operator">&lt;</span>E<span class="token operator">></span><span class="token punctuation">,</span> RandomAccess<span class="token punctuation">,</span> Cloneable<span class="token punctuation">,</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>Serializable    
<span class="token punctuation">{</span>    
    <span class="token comment" spellcheck="true">// 序列版本号    </span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> 8683452581122892189L<span class="token punctuation">;</span>    

    <span class="token comment" spellcheck="true">// ArrayList基于该数组实现，用该数组保存数据   </span>
    <span class="token keyword">private</span> <span class="token keyword">transient</span> Object<span class="token punctuation">[</span><span class="token punctuation">]</span> elementData<span class="token punctuation">;</span>    

    <span class="token comment" spellcheck="true">// ArrayList中实际数据的数量    </span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> size<span class="token punctuation">;</span>    

    <span class="token comment" spellcheck="true">// ArrayList带容量大小的构造函数。    </span>
    <span class="token keyword">public</span> <span class="token function">ArrayList</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token keyword">if</span> <span class="token punctuation">(</span>initialCapacity <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>    
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Illegal Capacity: "</span><span class="token operator">+</span>    
                                               initialCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token comment" spellcheck="true">// 新建一个数组    </span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>elementData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span>initialCapacity<span class="token punctuation">]</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// ArrayList无参构造函数。默认容量是10。    </span>
    <span class="token keyword">public</span> <span class="token function">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">this</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 创建一个包含collection的ArrayList    </span>
    <span class="token keyword">public</span> <span class="token function">ArrayList</span><span class="token punctuation">(</span>Collection<span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">E</span><span class="token operator">></span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        elementData <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        size <span class="token operator">=</span> elementData<span class="token punctuation">.</span>length<span class="token punctuation">;</span>    
        <span class="token keyword">if</span> <span class="token punctuation">(</span>elementData<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> Object<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    
            elementData <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>elementData<span class="token punctuation">,</span> size<span class="token punctuation">,</span> Object<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    


    <span class="token comment" spellcheck="true">// 将当前容量值设为实际元素个数    </span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">trimToSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        modCount<span class="token operator">++</span><span class="token punctuation">;</span>    
        <span class="token keyword">int</span> oldCapacity <span class="token operator">=</span> elementData<span class="token punctuation">.</span>length<span class="token punctuation">;</span>    
        <span class="token keyword">if</span> <span class="token punctuation">(</span>size <span class="token operator">&lt;</span> oldCapacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            elementData <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>elementData<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    
    <span class="token punctuation">}</span>    


    <span class="token comment" spellcheck="true">// 确定ArrarList的容量。    </span>
    <span class="token comment" spellcheck="true">// 若ArrayList的容量不足以容纳当前的全部元素，设置 新的容量=“(原始容量x3)/2 + 1”    </span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">ensureCapacity</span><span class="token punctuation">(</span><span class="token keyword">int</span> minCapacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token comment" spellcheck="true">// 将“修改统计数”+1，该变量主要是用来实现fail-fast机制的    </span>
        modCount<span class="token operator">++</span><span class="token punctuation">;</span>    
        <span class="token keyword">int</span> oldCapacity <span class="token operator">=</span> elementData<span class="token punctuation">.</span>length<span class="token punctuation">;</span>    
        <span class="token comment" spellcheck="true">// 若当前容量不足以容纳当前的元素个数，设置 新的容量=“(原始容量x3)/2 + 1”    </span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>minCapacity <span class="token operator">></span> oldCapacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            Object oldData<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> elementData<span class="token punctuation">;</span>    
            <span class="token keyword">int</span> newCapacity <span class="token operator">=</span> <span class="token punctuation">(</span>oldCapacity <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>    
            <span class="token comment" spellcheck="true">//如果还不够，则直接将minCapacity设置为当前容量  </span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>newCapacity <span class="token operator">&lt;</span> minCapacity<span class="token punctuation">)</span>    
                newCapacity <span class="token operator">=</span> minCapacity<span class="token punctuation">;</span>    
            elementData <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>elementData<span class="token punctuation">,</span> newCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 添加元素e    </span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">add</span><span class="token punctuation">(</span>E e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token comment" spellcheck="true">// 确定ArrayList的容量大小    </span>
        <span class="token function">ensureCapacity</span><span class="token punctuation">(</span>size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// Increments modCount!!    </span>
        <span class="token comment" spellcheck="true">// 添加e到ArrayList中    </span>
        elementData<span class="token punctuation">[</span>size<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>    
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 返回ArrayList的实际大小    </span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">return</span> size<span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// ArrayList是否包含Object(o)    </span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">contains</span><span class="token punctuation">(</span>Object o<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">return</span> <span class="token function">indexOf</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">//返回ArrayList是否为空    </span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">return</span> size <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 正向查找，返回元素的索引值    </span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">indexOf</span><span class="token punctuation">(</span>Object o<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>    
            <span class="token keyword">if</span> <span class="token punctuation">(</span>elementData<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span>null<span class="token punctuation">)</span>    
                <span class="token keyword">return</span> i<span class="token punctuation">;</span>    
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>    
                <span class="token keyword">if</span> <span class="token punctuation">(</span>o<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>elementData<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    
                    <span class="token keyword">return</span> i<span class="token punctuation">;</span>    
            <span class="token punctuation">}</span>    
            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 反向查找(从数组末尾向开始查找)，返回元素(o)的索引值    </span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">lastIndexOf</span><span class="token punctuation">(</span>Object o<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> size<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span>    
            <span class="token keyword">if</span> <span class="token punctuation">(</span>elementData<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span>null<span class="token punctuation">)</span>    
                <span class="token keyword">return</span> i<span class="token punctuation">;</span>    
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> size<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span>    
            <span class="token keyword">if</span> <span class="token punctuation">(</span>o<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>elementData<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    
                <span class="token keyword">return</span> i<span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    


    <span class="token comment" spellcheck="true">// 返回ArrayList的Object数组    </span>
    <span class="token keyword">public</span> Object<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">return</span> Arrays<span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>elementData<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 返回ArrayList元素组成的数组  </span>
    <span class="token keyword">public</span> <span class="token operator">&lt;</span>T<span class="token operator">></span> T<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">toArray</span><span class="token punctuation">(</span>T<span class="token punctuation">[</span><span class="token punctuation">]</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token comment" spellcheck="true">// 若数组a的大小 &lt; ArrayList的元素个数；    </span>
        <span class="token comment" spellcheck="true">// 则新建一个T[]数组，数组大小是“ArrayList的元素个数”，并将“ArrayList”全部拷贝到新数组中    </span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> size<span class="token punctuation">)</span>    
            <span class="token keyword">return</span> <span class="token punctuation">(</span>T<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> Arrays<span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>elementData<span class="token punctuation">,</span> size<span class="token punctuation">,</span> a<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    

        <span class="token comment" spellcheck="true">// 若数组a的大小 >= ArrayList的元素个数；    </span>
        <span class="token comment" spellcheck="true">// 则将ArrayList的全部元素都拷贝到数组a中。    </span>
        System<span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>elementData<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>length <span class="token operator">></span> size<span class="token punctuation">)</span>    
            a<span class="token punctuation">[</span>size<span class="token punctuation">]</span> <span class="token operator">=</span> null<span class="token punctuation">;</span>    
        <span class="token keyword">return</span> a<span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 获取index位置的元素值    </span>
    <span class="token keyword">public</span> E <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token function">RangeCheck</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>    

        <span class="token keyword">return</span> <span class="token punctuation">(</span>E<span class="token punctuation">)</span> elementData<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 设置index位置的值为element    </span>
    <span class="token keyword">public</span> E <span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">,</span> E element<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token function">RangeCheck</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>    

        E oldValue <span class="token operator">=</span> <span class="token punctuation">(</span>E<span class="token punctuation">)</span> elementData<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>    
        elementData<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> element<span class="token punctuation">;</span>    
        <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 将e添加到ArrayList中    </span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">add</span><span class="token punctuation">(</span>E e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token function">ensureCapacity</span><span class="token punctuation">(</span>size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// Increments modCount!!    </span>
        elementData<span class="token punctuation">[</span>size<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>    
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 将e添加到ArrayList的指定位置    </span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">,</span> E element<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">></span> size <span class="token operator">||</span> index <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>    
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IndexOutOfBoundsException</span><span class="token punctuation">(</span>    
            <span class="token string">"Index: "</span><span class="token operator">+</span>index<span class="token operator">+</span><span class="token string">", Size: "</span><span class="token operator">+</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>    

        <span class="token function">ensureCapacity</span><span class="token punctuation">(</span>size<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// Increments modCount!!    </span>
        System<span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>elementData<span class="token punctuation">,</span> index<span class="token punctuation">,</span> elementData<span class="token punctuation">,</span> index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>    
             size <span class="token operator">-</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        elementData<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> element<span class="token punctuation">;</span>    
        size<span class="token operator">++</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 删除ArrayList指定位置的元素    </span>
    <span class="token keyword">public</span> E <span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token function">RangeCheck</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>    

        modCount<span class="token operator">++</span><span class="token punctuation">;</span>    
        E oldValue <span class="token operator">=</span> <span class="token punctuation">(</span>E<span class="token punctuation">)</span> elementData<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>    

        <span class="token keyword">int</span> numMoved <span class="token operator">=</span> size <span class="token operator">-</span> index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>    
        <span class="token keyword">if</span> <span class="token punctuation">(</span>numMoved <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span>    
            System<span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>elementData<span class="token punctuation">,</span> index<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> elementData<span class="token punctuation">,</span> index<span class="token punctuation">,</span>    
                 numMoved<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        elementData<span class="token punctuation">[</span><span class="token operator">--</span>size<span class="token punctuation">]</span> <span class="token operator">=</span> null<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Let gc do its work    </span>

        <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 删除ArrayList的指定元素    </span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">remove</span><span class="token punctuation">(</span>Object o<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> index <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> index<span class="token operator">++</span><span class="token punctuation">)</span>    
            <span class="token keyword">if</span> <span class="token punctuation">(</span>elementData<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
                <span class="token function">fastRemove</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>    
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    
            <span class="token punctuation">}</span>    
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> index <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> index<span class="token operator">++</span><span class="token punctuation">)</span>    
            <span class="token keyword">if</span> <span class="token punctuation">(</span>o<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>elementData<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
                <span class="token function">fastRemove</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>    
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    
            <span class="token punctuation">}</span>    
        <span class="token punctuation">}</span>    
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    


    <span class="token comment" spellcheck="true">// 快速删除第index个元素    </span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">fastRemove</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        modCount<span class="token operator">++</span><span class="token punctuation">;</span>    
        <span class="token keyword">int</span> numMoved <span class="token operator">=</span> size <span class="token operator">-</span> index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>    
        <span class="token comment" spellcheck="true">// 从"index+1"开始，用后面的元素替换前面的元素。    </span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>numMoved <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span>    
            System<span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>elementData<span class="token punctuation">,</span> index<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> elementData<span class="token punctuation">,</span> index<span class="token punctuation">,</span>    
                             numMoved<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token comment" spellcheck="true">// 将最后一个元素设为null    </span>
        elementData<span class="token punctuation">[</span><span class="token operator">--</span>size<span class="token punctuation">]</span> <span class="token operator">=</span> null<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Let gc do its work    </span>
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 删除元素    </span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">remove</span><span class="token punctuation">(</span>Object o<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> index <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> index<span class="token operator">++</span><span class="token punctuation">)</span>    
            <span class="token keyword">if</span> <span class="token punctuation">(</span>elementData<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
                <span class="token function">fastRemove</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>    
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    
            <span class="token punctuation">}</span>    
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    
            <span class="token comment" spellcheck="true">// 便利ArrayList，找到“元素o”，则删除，并返回true。    </span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> index <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> index<span class="token operator">++</span><span class="token punctuation">)</span>    
            <span class="token keyword">if</span> <span class="token punctuation">(</span>o<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>elementData<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
                <span class="token function">fastRemove</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>    
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    
            <span class="token punctuation">}</span>    
        <span class="token punctuation">}</span>    
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 清空ArrayList，将全部的元素设为null    </span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        modCount<span class="token operator">++</span><span class="token punctuation">;</span>    

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>    
            elementData<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> null<span class="token punctuation">;</span>    

        size <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 将集合c追加到ArrayList中    </span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">addAll</span><span class="token punctuation">(</span>Collection<span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">E</span><span class="token operator">></span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        Object<span class="token punctuation">[</span><span class="token punctuation">]</span> a <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token keyword">int</span> numNew <span class="token operator">=</span> a<span class="token punctuation">.</span>length<span class="token punctuation">;</span>    
        <span class="token function">ensureCapacity</span><span class="token punctuation">(</span>size <span class="token operator">+</span> numNew<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// Increments modCount    </span>
        System<span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> elementData<span class="token punctuation">,</span> size<span class="token punctuation">,</span> numNew<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        size <span class="token operator">+=</span> numNew<span class="token punctuation">;</span>    
        <span class="token keyword">return</span> numNew <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 从index位置开始，将集合c添加到ArrayList    </span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">addAll</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">,</span> Collection<span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">E</span><span class="token operator">></span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">></span> size <span class="token operator">||</span> index <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>    
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IndexOutOfBoundsException</span><span class="token punctuation">(</span>    
            <span class="token string">"Index: "</span> <span class="token operator">+</span> index <span class="token operator">+</span> <span class="token string">", Size: "</span> <span class="token operator">+</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>    

        Object<span class="token punctuation">[</span><span class="token punctuation">]</span> a <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token keyword">int</span> numNew <span class="token operator">=</span> a<span class="token punctuation">.</span>length<span class="token punctuation">;</span>    
        <span class="token function">ensureCapacity</span><span class="token punctuation">(</span>size <span class="token operator">+</span> numNew<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// Increments modCount    </span>

        <span class="token keyword">int</span> numMoved <span class="token operator">=</span> size <span class="token operator">-</span> index<span class="token punctuation">;</span>    
        <span class="token keyword">if</span> <span class="token punctuation">(</span>numMoved <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span>    
            System<span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>elementData<span class="token punctuation">,</span> index<span class="token punctuation">,</span> elementData<span class="token punctuation">,</span> index <span class="token operator">+</span> numNew<span class="token punctuation">,</span>    
                 numMoved<span class="token punctuation">)</span><span class="token punctuation">;</span>    

        System<span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> elementData<span class="token punctuation">,</span> index<span class="token punctuation">,</span> numNew<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        size <span class="token operator">+=</span> numNew<span class="token punctuation">;</span>    
        <span class="token keyword">return</span> numNew <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 删除fromIndex到toIndex之间的全部元素。    </span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">removeRange</span><span class="token punctuation">(</span><span class="token keyword">int</span> fromIndex<span class="token punctuation">,</span> <span class="token keyword">int</span> toIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
    modCount<span class="token operator">++</span><span class="token punctuation">;</span>    
    <span class="token keyword">int</span> numMoved <span class="token operator">=</span> size <span class="token operator">-</span> toIndex<span class="token punctuation">;</span>    
        System<span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>elementData<span class="token punctuation">,</span> toIndex<span class="token punctuation">,</span> elementData<span class="token punctuation">,</span> fromIndex<span class="token punctuation">,</span>    
                         numMoved<span class="token punctuation">)</span><span class="token punctuation">;</span>    

    <span class="token comment" spellcheck="true">// Let gc do its work    </span>
    <span class="token keyword">int</span> newSize <span class="token operator">=</span> size <span class="token operator">-</span> <span class="token punctuation">(</span>toIndex<span class="token operator">-</span>fromIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token keyword">while</span> <span class="token punctuation">(</span>size <span class="token operator">!=</span> newSize<span class="token punctuation">)</span>    
        elementData<span class="token punctuation">[</span><span class="token operator">--</span>size<span class="token punctuation">]</span> <span class="token operator">=</span> null<span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">RangeCheck</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">>=</span> size<span class="token punctuation">)</span>    
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IndexOutOfBoundsException</span><span class="token punctuation">(</span>    
        <span class="token string">"Index: "</span><span class="token operator">+</span>index<span class="token operator">+</span><span class="token string">", Size: "</span><span class="token operator">+</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    


    <span class="token comment" spellcheck="true">// 克隆函数    </span>
    <span class="token keyword">public</span> Object <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">try</span> <span class="token punctuation">{</span>    
            ArrayList<span class="token operator">&lt;</span>E<span class="token operator">></span> v <span class="token operator">=</span> <span class="token punctuation">(</span>ArrayList<span class="token operator">&lt;</span>E<span class="token operator">></span><span class="token punctuation">)</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
            <span class="token comment" spellcheck="true">// 将当前ArrayList的全部元素拷贝到v中    </span>
            v<span class="token punctuation">.</span>elementData <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>elementData<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>    
            v<span class="token punctuation">.</span>modCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    
            <span class="token keyword">return</span> v<span class="token punctuation">;</span>    
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">CloneNotSupportedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token comment" spellcheck="true">// this shouldn't happen, since we are Cloneable    </span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">InternalError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    
    <span class="token punctuation">}</span>    


    <span class="token comment" spellcheck="true">// java.io.Serializable的写入函数    </span>
    <span class="token comment" spellcheck="true">// 将ArrayList的“容量，所有的元素值”都写入到输出流中    </span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">writeObject</span><span class="token punctuation">(</span>java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>ObjectOutputStream s<span class="token punctuation">)</span>    
        <span class="token keyword">throws</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>IOException<span class="token punctuation">{</span>    
    <span class="token comment" spellcheck="true">// Write out element count, and any hidden stuff    </span>
    <span class="token keyword">int</span> expectedModCount <span class="token operator">=</span> modCount<span class="token punctuation">;</span>    
    s<span class="token punctuation">.</span><span class="token function">defaultWriteObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    

        <span class="token comment" spellcheck="true">// 写入“数组的容量”    </span>
        s<span class="token punctuation">.</span><span class="token function">writeInt</span><span class="token punctuation">(</span>elementData<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>    

    <span class="token comment" spellcheck="true">// 写入“数组的每一个元素”    </span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>    
            s<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>elementData<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    

    <span class="token keyword">if</span> <span class="token punctuation">(</span>modCount <span class="token operator">!=</span> expectedModCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentModificationException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    

    <span class="token punctuation">}</span>    


    <span class="token comment" spellcheck="true">// java.io.Serializable的读取函数：根据写入方式读出    </span>
    <span class="token comment" spellcheck="true">// 先将ArrayList的“容量”读出，然后将“所有的元素值”读出    </span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">readObject</span><span class="token punctuation">(</span>java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>ObjectInputStream s<span class="token punctuation">)</span>    
        <span class="token keyword">throws</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>IOException<span class="token punctuation">,</span> ClassNotFoundException <span class="token punctuation">{</span>    
        <span class="token comment" spellcheck="true">// Read in size, and any hidden stuff    </span>
        s<span class="token punctuation">.</span><span class="token function">defaultReadObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    

        <span class="token comment" spellcheck="true">// 从输入流中读取ArrayList的“容量”    </span>
        <span class="token keyword">int</span> arrayLength <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        Object<span class="token punctuation">[</span><span class="token punctuation">]</span> a <span class="token operator">=</span> elementData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span>arrayLength<span class="token punctuation">]</span><span class="token punctuation">;</span>    

        <span class="token comment" spellcheck="true">// 从输入流中将“所有的元素值”读出    </span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>    
            a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    
<span class="token punctuation">}</span>  </code></pre>
<hr>
<h1 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h1><p>HashMap是基于哈希表实现，每一个元素都是一个key-value对，其内部通过单链表解决冲突问题，容量不足时，会自动增长。</p>
<p>非线程安全，只是用于单线程环境下，多线程用concurrentHashMap</p>
<p>实现了Serializable接口，因此支持序列化，实现了Cloneable接口，能被克隆。</p>
<p>源码：</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> java<span class="token punctuation">.</span>util<span class="token punctuation">;</span>    
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>*<span class="token punctuation">;</span>    

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span>    
    <span class="token keyword">extends</span> <span class="token class-name">AbstractMap</span><span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span>    
    <span class="token keyword">implements</span> <span class="token class-name">Map</span><span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span><span class="token punctuation">,</span> Cloneable<span class="token punctuation">,</span> Serializable    
<span class="token punctuation">{</span>    

    <span class="token comment" spellcheck="true">// 默认的初始容量（容量为HashMap中槽的数目）是16，且实际容量必须是2的整数次幂。    </span>
    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> DEFAULT_INITIAL_CAPACITY <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>    

    <span class="token comment" spellcheck="true">// 最大容量（必须是2的幂且小于2的30次方，传入容量过大将被这个值替换）    </span>
    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> MAXIMUM_CAPACITY <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">30</span><span class="token punctuation">;</span>    

    <span class="token comment" spellcheck="true">// 默认加载因子为0.75   </span>
    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">float</span> DEFAULT_LOAD_FACTOR <span class="token operator">=</span> <span class="token number">0.75f</span><span class="token punctuation">;</span>    

    <span class="token comment" spellcheck="true">// 存储数据的Entry数组，长度是2的幂。    </span>
    <span class="token comment" spellcheck="true">// HashMap采用链表法解决冲突，每一个Entry本质上是一个单向链表    </span>
    <span class="token keyword">transient</span> Entry<span class="token punctuation">[</span><span class="token punctuation">]</span> table<span class="token punctuation">;</span>    

    <span class="token comment" spellcheck="true">// HashMap的底层数组中已用槽的数量    </span>
    <span class="token keyword">transient</span> <span class="token keyword">int</span> size<span class="token punctuation">;</span>    

    <span class="token comment" spellcheck="true">// HashMap的阈值，用于判断是否需要调整HashMap的容量（threshold = 容量*加载因子）    </span>
    <span class="token keyword">int</span> threshold<span class="token punctuation">;</span>    

    <span class="token comment" spellcheck="true">// 加载因子实际大小    </span>
    <span class="token keyword">final</span> <span class="token keyword">float</span> loadFactor<span class="token punctuation">;</span>    

    <span class="token comment" spellcheck="true">// HashMap被改变的次数    </span>
    <span class="token keyword">transient</span> <span class="token keyword">volatile</span> <span class="token keyword">int</span> modCount<span class="token punctuation">;</span>    

    <span class="token comment" spellcheck="true">// 指定“容量大小”和“加载因子”的构造函数    </span>
    <span class="token keyword">public</span> <span class="token function">HashMap</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">,</span> <span class="token keyword">float</span> loadFactor<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">if</span> <span class="token punctuation">(</span>initialCapacity <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>    
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Illegal initial capacity: "</span> <span class="token operator">+</span>    
                                               initialCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token comment" spellcheck="true">// HashMap的最大容量只能是MAXIMUM_CAPACITY    </span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>initialCapacity <span class="token operator">></span> MAXIMUM_CAPACITY<span class="token punctuation">)</span>    
            initialCapacity <span class="token operator">=</span> MAXIMUM_CAPACITY<span class="token punctuation">;</span>    
        <span class="token comment" spellcheck="true">//加载因此不能小于0  </span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>loadFactor <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">||</span> Float<span class="token punctuation">.</span><span class="token function">isNaN</span><span class="token punctuation">(</span>loadFactor<span class="token punctuation">)</span><span class="token punctuation">)</span>    
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Illegal load factor: "</span> <span class="token operator">+</span>    
                                               loadFactor<span class="token punctuation">)</span><span class="token punctuation">;</span>    

        <span class="token comment" spellcheck="true">// 找出“大于initialCapacity”的最小的2的幂    </span>
        <span class="token keyword">int</span> capacity <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    
        <span class="token keyword">while</span> <span class="token punctuation">(</span>capacity <span class="token operator">&lt;</span> initialCapacity<span class="token punctuation">)</span>    
            capacity <span class="token operator">&lt;&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>    

        <span class="token comment" spellcheck="true">// 设置“加载因子”    </span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>loadFactor <span class="token operator">=</span> loadFactor<span class="token punctuation">;</span>    
        <span class="token comment" spellcheck="true">// 设置“HashMap阈值”，当HashMap中存储数据的数量达到threshold时，就需要将HashMap的容量加倍。    </span>
        threshold <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>capacity <span class="token operator">*</span> loadFactor<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token comment" spellcheck="true">// 创建Entry数组，用来保存数据    </span>
        table <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Entry</span><span class="token punctuation">[</span>capacity<span class="token punctuation">]</span><span class="token punctuation">;</span>    
        <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    


    <span class="token comment" spellcheck="true">// 指定“容量大小”的构造函数    </span>
    <span class="token keyword">public</span> <span class="token function">HashMap</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">this</span><span class="token punctuation">(</span>initialCapacity<span class="token punctuation">,</span> DEFAULT_LOAD_FACTOR<span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 默认构造函数。    </span>
    <span class="token keyword">public</span> <span class="token function">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token comment" spellcheck="true">// 设置“加载因子”为默认加载因子0.75    </span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>loadFactor <span class="token operator">=</span> DEFAULT_LOAD_FACTOR<span class="token punctuation">;</span>    
        <span class="token comment" spellcheck="true">// 设置“HashMap阈值”，当HashMap中存储数据的数量达到threshold时，就需要将HashMap的容量加倍。    </span>
        threshold <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>DEFAULT_INITIAL_CAPACITY <span class="token operator">*</span> DEFAULT_LOAD_FACTOR<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token comment" spellcheck="true">// 创建Entry数组，用来保存数据    </span>
        table <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Entry</span><span class="token punctuation">[</span>DEFAULT_INITIAL_CAPACITY<span class="token punctuation">]</span><span class="token punctuation">;</span>    
        <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 包含“子Map”的构造函数    </span>
    <span class="token keyword">public</span> <span class="token function">HashMap</span><span class="token punctuation">(</span>Map<span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">V</span><span class="token operator">></span> m<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">this</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> DEFAULT_LOAD_FACTOR<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>    
                      DEFAULT_INITIAL_CAPACITY<span class="token punctuation">)</span><span class="token punctuation">,</span> DEFAULT_LOAD_FACTOR<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token comment" spellcheck="true">// 将m中的全部元素逐个添加到HashMap中    </span>
        <span class="token function">putAllForCreate</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">//求hash值的方法，重新计算hash值  </span>
    <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">hash</span><span class="token punctuation">(</span><span class="token keyword">int</span> h<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        h <span class="token operator">^=</span> <span class="token punctuation">(</span>h <span class="token operator">>>></span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>h <span class="token operator">>>></span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token keyword">return</span> h <span class="token operator">^</span> <span class="token punctuation">(</span>h <span class="token operator">>>></span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>h <span class="token operator">>>></span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 返回h在数组中的索引值，这里用&amp;代替取模，旨在提升效率   </span>
    <span class="token comment" spellcheck="true">// h &amp; (length-1)保证返回值的小于length    </span>
    <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">indexFor</span><span class="token punctuation">(</span><span class="token keyword">int</span> h<span class="token punctuation">,</span> <span class="token keyword">int</span> length<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">return</span> h <span class="token operator">&amp;</span> <span class="token punctuation">(</span>length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">return</span> size<span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">return</span> size <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 获取key对应的value    </span>
    <span class="token keyword">public</span> V <span class="token function">get</span><span class="token punctuation">(</span>Object key<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> null<span class="token punctuation">)</span>    
            <span class="token keyword">return</span> <span class="token function">getForNullKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token comment" spellcheck="true">// 获取key的hash值    </span>
        <span class="token keyword">int</span> hash <span class="token operator">=</span> <span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token comment" spellcheck="true">// 在“该hash值对应的链表”上查找“键值等于key”的元素    </span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span> e <span class="token operator">=</span> table<span class="token punctuation">[</span><span class="token function">indexFor</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> table<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    
             e <span class="token operator">!=</span> null<span class="token punctuation">;</span>    
             e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            Object k<span class="token punctuation">;</span>    
            <span class="token comment" spellcheck="true">//判断key是否相同  </span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    
                <span class="token keyword">return</span> e<span class="token punctuation">.</span>value<span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>  
        <span class="token comment" spellcheck="true">//没找到则返回null  </span>
        <span class="token keyword">return</span> null<span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 获取“key为null”的元素的值    </span>
    <span class="token comment" spellcheck="true">// HashMap将“key为null”的元素存储在table[0]位置，但不一定是该链表的第一个位置！    </span>
    <span class="token keyword">private</span> V <span class="token function">getForNullKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">for</span> <span class="token punctuation">(</span>Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span> e <span class="token operator">=</span> table<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> e <span class="token operator">!=</span> null<span class="token punctuation">;</span> e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>key <span class="token operator">==</span> null<span class="token punctuation">)</span>    
                <span class="token keyword">return</span> e<span class="token punctuation">.</span>value<span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    
        <span class="token keyword">return</span> null<span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// HashMap是否包含key    </span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">containsKey</span><span class="token punctuation">(</span>Object key<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">return</span> <span class="token function">getEntry</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">!=</span> null<span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 返回“键为key”的键值对    </span>
    <span class="token keyword">final</span> Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span> <span class="token function">getEntry</span><span class="token punctuation">(</span>Object key<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token comment" spellcheck="true">// 获取哈希值    </span>
        <span class="token comment" spellcheck="true">// HashMap将“key为null”的元素存储在table[0]位置，“key不为null”的则调用hash()计算哈希值    </span>
        <span class="token keyword">int</span> hash <span class="token operator">=</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token comment" spellcheck="true">// 在“该hash值对应的链表”上查找“键值等于key”的元素    </span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span> e <span class="token operator">=</span> table<span class="token punctuation">[</span><span class="token function">indexFor</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> table<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    
             e <span class="token operator">!=</span> null<span class="token punctuation">;</span>    
             e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            Object k<span class="token punctuation">;</span>    
            <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span>    
                <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    
                <span class="token keyword">return</span> e<span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    
        <span class="token keyword">return</span> null<span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 将“key-value”添加到HashMap中    </span>
    <span class="token keyword">public</span> V <span class="token function">put</span><span class="token punctuation">(</span>K key<span class="token punctuation">,</span> V value<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token comment" spellcheck="true">// 若“key为null”，则将该键值对添加到table[0]中。    </span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> null<span class="token punctuation">)</span>    
            <span class="token keyword">return</span> <span class="token function">putForNullKey</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token comment" spellcheck="true">// 若“key不为null”，则计算该key的哈希值，然后将其添加到该哈希值对应的链表中。    </span>
        <span class="token keyword">int</span> hash <span class="token operator">=</span> <span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token function">indexFor</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> table<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token keyword">for</span> <span class="token punctuation">(</span>Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span> e <span class="token operator">=</span> table<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> e <span class="token operator">!=</span> null<span class="token punctuation">;</span> e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            Object k<span class="token punctuation">;</span>    
            <span class="token comment" spellcheck="true">// 若“该key”对应的键值对已经存在，则用新的value取代旧的value。然后退出！    </span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
                V oldValue <span class="token operator">=</span> e<span class="token punctuation">.</span>value<span class="token punctuation">;</span>    
                e<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>    
                e<span class="token punctuation">.</span><span class="token function">recordAccess</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
                <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span>    
            <span class="token punctuation">}</span>    
        <span class="token punctuation">}</span>    

        <span class="token comment" spellcheck="true">// 若“该key”对应的键值对不存在，则将“key-value”添加到table中    </span>
        modCount<span class="token operator">++</span><span class="token punctuation">;</span>  
        <span class="token comment" spellcheck="true">//将key-value添加到table[i]处  </span>
        <span class="token function">addEntry</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token keyword">return</span> null<span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// putForNullKey()的作用是将“key为null”键值对添加到table[0]位置    </span>
    <span class="token keyword">private</span> V <span class="token function">putForNullKey</span><span class="token punctuation">(</span>V value<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">for</span> <span class="token punctuation">(</span>Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span> e <span class="token operator">=</span> table<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> e <span class="token operator">!=</span> null<span class="token punctuation">;</span> e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>key <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
                V oldValue <span class="token operator">=</span> e<span class="token punctuation">.</span>value<span class="token punctuation">;</span>    
                e<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>    
                e<span class="token punctuation">.</span><span class="token function">recordAccess</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
                <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span>    
            <span class="token punctuation">}</span>    
        <span class="token punctuation">}</span>    
        <span class="token comment" spellcheck="true">// 如果没有存在key为null的键值对，则直接题阿见到table[0]处!    </span>
        modCount<span class="token operator">++</span><span class="token punctuation">;</span>    
        <span class="token function">addEntry</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> null<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token keyword">return</span> null<span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 创建HashMap对应的“添加方法”，    </span>
    <span class="token comment" spellcheck="true">// 它和put()不同。putForCreate()是内部方法，它被构造函数等调用，用来创建HashMap    </span>
    <span class="token comment" spellcheck="true">// 而put()是对外提供的往HashMap中添加元素的方法。    </span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">putForCreate</span><span class="token punctuation">(</span>K key<span class="token punctuation">,</span> V value<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">int</span> hash <span class="token operator">=</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token function">indexFor</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> table<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>    

        <span class="token comment" spellcheck="true">// 若该HashMap表中存在“键值等于key”的元素，则替换该元素的value值    </span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span> e <span class="token operator">=</span> table<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> e <span class="token operator">!=</span> null<span class="token punctuation">;</span> e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            Object k<span class="token punctuation">;</span>    
            <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span>    
                <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
                e<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>    
                <span class="token keyword">return</span><span class="token punctuation">;</span>    
            <span class="token punctuation">}</span>    
        <span class="token punctuation">}</span>    

        <span class="token comment" spellcheck="true">// 若该HashMap表中不存在“键值等于key”的元素，则将该key-value添加到HashMap中    </span>
        <span class="token function">createEntry</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 将“m”中的全部元素都添加到HashMap中。    </span>
    <span class="token comment" spellcheck="true">// 该方法被内部的构造HashMap的方法所调用。    </span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">putAllForCreate</span><span class="token punctuation">(</span>Map<span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">V</span><span class="token operator">></span> m<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token comment" spellcheck="true">// 利用迭代器将元素逐个添加到HashMap中    </span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>Iterator<span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">V</span><span class="token operator">>></span> i <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            Map<span class="token punctuation">.</span>Entry<span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">V</span><span class="token operator">></span> e <span class="token operator">=</span> i<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
            <span class="token function">putForCreate</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 重新调整HashMap的大小，newCapacity是调整后的容量    </span>
    <span class="token keyword">void</span> <span class="token function">resize</span><span class="token punctuation">(</span><span class="token keyword">int</span> newCapacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        Entry<span class="token punctuation">[</span><span class="token punctuation">]</span> oldTable <span class="token operator">=</span> table<span class="token punctuation">;</span>    
        <span class="token keyword">int</span> oldCapacity <span class="token operator">=</span> oldTable<span class="token punctuation">.</span>length<span class="token punctuation">;</span>   
        <span class="token comment" spellcheck="true">//如果就容量已经达到了最大值，则不能再扩容，直接返回  </span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCapacity <span class="token operator">==</span> MAXIMUM_CAPACITY<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            threshold <span class="token operator">=</span> Integer<span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">;</span>    
            <span class="token keyword">return</span><span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    

        <span class="token comment" spellcheck="true">// 新建一个HashMap，将“旧HashMap”的全部元素添加到“新HashMap”中，    </span>
        <span class="token comment" spellcheck="true">// 然后，将“新HashMap”赋值给“旧HashMap”。    </span>
        Entry<span class="token punctuation">[</span><span class="token punctuation">]</span> newTable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Entry</span><span class="token punctuation">[</span>newCapacity<span class="token punctuation">]</span><span class="token punctuation">;</span>    
        <span class="token function">transfer</span><span class="token punctuation">(</span>newTable<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        table <span class="token operator">=</span> newTable<span class="token punctuation">;</span>    
        threshold <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>newCapacity <span class="token operator">*</span> loadFactor<span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 将HashMap中的全部元素都添加到newTable中    </span>
    <span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span>Entry<span class="token punctuation">[</span><span class="token punctuation">]</span> newTable<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        Entry<span class="token punctuation">[</span><span class="token punctuation">]</span> src <span class="token operator">=</span> table<span class="token punctuation">;</span>    
        <span class="token keyword">int</span> newCapacity <span class="token operator">=</span> newTable<span class="token punctuation">.</span>length<span class="token punctuation">;</span>    
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> src<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span> e <span class="token operator">=</span> src<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>    
            <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
                src<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> null<span class="token punctuation">;</span>    
                <span class="token keyword">do</span> <span class="token punctuation">{</span>    
                    Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span> next <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">;</span>    
                    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token function">indexFor</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash<span class="token punctuation">,</span> newCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>    
                    e<span class="token punctuation">.</span>next <span class="token operator">=</span> newTable<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>    
                    newTable<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>    
                    e <span class="token operator">=</span> next<span class="token punctuation">;</span>    
                <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span>    
            <span class="token punctuation">}</span>    
        <span class="token punctuation">}</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 将"m"的全部元素都添加到HashMap中    </span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">putAll</span><span class="token punctuation">(</span>Map<span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">V</span><span class="token operator">></span> m<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token comment" spellcheck="true">// 有效性判断    </span>
        <span class="token keyword">int</span> numKeysToBeAdded <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token keyword">if</span> <span class="token punctuation">(</span>numKeysToBeAdded <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>    
            <span class="token keyword">return</span><span class="token punctuation">;</span>    

        <span class="token comment" spellcheck="true">// 计算容量是否足够，    </span>
        <span class="token comment" spellcheck="true">// 若“当前阀值容量 &lt; 需要的容量”，则将容量x2。    </span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>numKeysToBeAdded <span class="token operator">></span> threshold<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">int</span> targetCapacity <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>numKeysToBeAdded <span class="token operator">/</span> loadFactor <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
            <span class="token keyword">if</span> <span class="token punctuation">(</span>targetCapacity <span class="token operator">></span> MAXIMUM_CAPACITY<span class="token punctuation">)</span>    
                targetCapacity <span class="token operator">=</span> MAXIMUM_CAPACITY<span class="token punctuation">;</span>    
            <span class="token keyword">int</span> newCapacity <span class="token operator">=</span> table<span class="token punctuation">.</span>length<span class="token punctuation">;</span>    
            <span class="token keyword">while</span> <span class="token punctuation">(</span>newCapacity <span class="token operator">&lt;</span> targetCapacity<span class="token punctuation">)</span>    
                newCapacity <span class="token operator">&lt;&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>    
            <span class="token keyword">if</span> <span class="token punctuation">(</span>newCapacity <span class="token operator">></span> table<span class="token punctuation">.</span>length<span class="token punctuation">)</span>    
                <span class="token function">resize</span><span class="token punctuation">(</span>newCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    

        <span class="token comment" spellcheck="true">// 通过迭代器，将“m”中的元素逐个添加到HashMap中。    </span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>Iterator<span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">V</span><span class="token operator">>></span> i <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            Map<span class="token punctuation">.</span>Entry<span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">V</span><span class="token operator">></span> e <span class="token operator">=</span> i<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
            <span class="token function">put</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 删除“键为key”元素    </span>
    <span class="token keyword">public</span> V <span class="token function">remove</span><span class="token punctuation">(</span>Object key<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span> e <span class="token operator">=</span> <span class="token function">removeEntryForKey</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token keyword">return</span> <span class="token punctuation">(</span>e <span class="token operator">==</span> null <span class="token operator">?</span> null <span class="token operator">:</span> e<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 删除“键为key”的元素    </span>
    <span class="token keyword">final</span> Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span> <span class="token function">removeEntryForKey</span><span class="token punctuation">(</span>Object key<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token comment" spellcheck="true">// 获取哈希值。若key为null，则哈希值为0；否则调用hash()进行计算    </span>
        <span class="token keyword">int</span> hash <span class="token operator">=</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token function">indexFor</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> table<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span> prev <span class="token operator">=</span> table<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>    
        Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span> e <span class="token operator">=</span> prev<span class="token punctuation">;</span>    

        <span class="token comment" spellcheck="true">// 删除链表中“键为key”的元素    </span>
        <span class="token comment" spellcheck="true">// 本质是“删除单向链表中的节点”    </span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span> next <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">;</span>    
            Object k<span class="token punctuation">;</span>    
            <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span>    
                <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
                modCount<span class="token operator">++</span><span class="token punctuation">;</span>    
                size<span class="token operator">--</span><span class="token punctuation">;</span>    
                <span class="token keyword">if</span> <span class="token punctuation">(</span>prev <span class="token operator">==</span> e<span class="token punctuation">)</span>    
                    table<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> next<span class="token punctuation">;</span>    
                <span class="token keyword">else</span>   
                    prev<span class="token punctuation">.</span>next <span class="token operator">=</span> next<span class="token punctuation">;</span>    
                e<span class="token punctuation">.</span><span class="token function">recordRemoval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
                <span class="token keyword">return</span> e<span class="token punctuation">;</span>    
            <span class="token punctuation">}</span>    
            prev <span class="token operator">=</span> e<span class="token punctuation">;</span>    
            e <span class="token operator">=</span> next<span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    

        <span class="token keyword">return</span> e<span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 删除“键值对”    </span>
    <span class="token keyword">final</span> Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span> <span class="token function">removeMapping</span><span class="token punctuation">(</span>Object o<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>o <span class="token keyword">instanceof</span> <span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    
            <span class="token keyword">return</span> null<span class="token punctuation">;</span>    

        Map<span class="token punctuation">.</span>Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span> entry <span class="token operator">=</span> <span class="token punctuation">(</span>Map<span class="token punctuation">.</span>Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span><span class="token punctuation">)</span> o<span class="token punctuation">;</span>    
        Object key <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token keyword">int</span> hash <span class="token operator">=</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token function">indexFor</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> table<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span> prev <span class="token operator">=</span> table<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>    
        Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span> e <span class="token operator">=</span> prev<span class="token punctuation">;</span>    

        <span class="token comment" spellcheck="true">// 删除链表中的“键值对e”    </span>
        <span class="token comment" spellcheck="true">// 本质是“删除单向链表中的节点”    </span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span> next <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">;</span>    
            <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span> e<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
                modCount<span class="token operator">++</span><span class="token punctuation">;</span>    
                size<span class="token operator">--</span><span class="token punctuation">;</span>    
                <span class="token keyword">if</span> <span class="token punctuation">(</span>prev <span class="token operator">==</span> e<span class="token punctuation">)</span>    
                    table<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> next<span class="token punctuation">;</span>    
                <span class="token keyword">else</span>   
                    prev<span class="token punctuation">.</span>next <span class="token operator">=</span> next<span class="token punctuation">;</span>    
                e<span class="token punctuation">.</span><span class="token function">recordRemoval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
                <span class="token keyword">return</span> e<span class="token punctuation">;</span>    
            <span class="token punctuation">}</span>    
            prev <span class="token operator">=</span> e<span class="token punctuation">;</span>    
            e <span class="token operator">=</span> next<span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    

        <span class="token keyword">return</span> e<span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 清空HashMap，将所有的元素设为null    </span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        modCount<span class="token operator">++</span><span class="token punctuation">;</span>    
        Entry<span class="token punctuation">[</span><span class="token punctuation">]</span> tab <span class="token operator">=</span> table<span class="token punctuation">;</span>    
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> tab<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>    
            tab<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> null<span class="token punctuation">;</span>    
        size <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 是否包含“值为value”的元素    </span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">containsValue</span><span class="token punctuation">(</span>Object value<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
    <span class="token comment" spellcheck="true">// 若“value为null”，则调用containsNullValue()查找    </span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">==</span> null<span class="token punctuation">)</span>    
            <span class="token keyword">return</span> <span class="token function">containsNullValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    

    <span class="token comment" spellcheck="true">// 若“value不为null”，则查找HashMap中是否有值为value的节点。    </span>
    Entry<span class="token punctuation">[</span><span class="token punctuation">]</span> tab <span class="token operator">=</span> table<span class="token punctuation">;</span>    
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> tab<span class="token punctuation">.</span>length <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>    
            <span class="token keyword">for</span> <span class="token punctuation">(</span>Entry e <span class="token operator">=</span> tab<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token punctuation">;</span> e <span class="token operator">!=</span> null <span class="token punctuation">;</span> e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span>    
                <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>    
                    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 是否包含null值    </span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">containsNullValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
    Entry<span class="token punctuation">[</span><span class="token punctuation">]</span> tab <span class="token operator">=</span> table<span class="token punctuation">;</span>    
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> tab<span class="token punctuation">.</span>length <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>    
            <span class="token keyword">for</span> <span class="token punctuation">(</span>Entry e <span class="token operator">=</span> tab<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token punctuation">;</span> e <span class="token operator">!=</span> null <span class="token punctuation">;</span> e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span>    
                <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>value <span class="token operator">==</span> null<span class="token punctuation">)</span>    
                    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 克隆一个HashMap，并返回Object对象    </span>
    <span class="token keyword">public</span> Object <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        HashMap<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span> result <span class="token operator">=</span> null<span class="token punctuation">;</span>    
        <span class="token keyword">try</span> <span class="token punctuation">{</span>    
            result <span class="token operator">=</span> <span class="token punctuation">(</span>HashMap<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span><span class="token punctuation">)</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">CloneNotSupportedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token comment" spellcheck="true">// assert false;    </span>
        <span class="token punctuation">}</span>    
        result<span class="token punctuation">.</span>table <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Entry</span><span class="token punctuation">[</span>table<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>    
        result<span class="token punctuation">.</span>entrySet <span class="token operator">=</span> null<span class="token punctuation">;</span>    
        result<span class="token punctuation">.</span>modCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    
        result<span class="token punctuation">.</span>size <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    
        result<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token comment" spellcheck="true">// 调用putAllForCreate()将全部元素添加到HashMap中    </span>
        result<span class="token punctuation">.</span><span class="token function">putAllForCreate</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    

        <span class="token keyword">return</span> result<span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// Entry是单向链表。    </span>
    <span class="token comment" spellcheck="true">// 它是 “HashMap链式存储法”对应的链表。    </span>
    <span class="token comment" spellcheck="true">// 它实现了Map.Entry 接口，即实现getKey(), getValue(), setValue(V value), equals(Object o), hashCode()这些函数    </span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Entry</span><span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span> <span class="token keyword">implements</span> <span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span> <span class="token punctuation">{</span>    
        <span class="token keyword">final</span> K key<span class="token punctuation">;</span>    
        V value<span class="token punctuation">;</span>    
        <span class="token comment" spellcheck="true">// 指向下一个节点    </span>
        Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span> next<span class="token punctuation">;</span>    
        <span class="token keyword">final</span> <span class="token keyword">int</span> hash<span class="token punctuation">;</span>    

        <span class="token comment" spellcheck="true">// 构造函数。    </span>
        <span class="token comment" spellcheck="true">// 输入参数包括"哈希值(h)", "键(k)", "值(v)", "下一节点(n)"    </span>
        <span class="token function">Entry</span><span class="token punctuation">(</span><span class="token keyword">int</span> h<span class="token punctuation">,</span> K k<span class="token punctuation">,</span> V v<span class="token punctuation">,</span> Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            value <span class="token operator">=</span> v<span class="token punctuation">;</span>    
            next <span class="token operator">=</span> n<span class="token punctuation">;</span>    
            key <span class="token operator">=</span> k<span class="token punctuation">;</span>    
            hash <span class="token operator">=</span> h<span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    

        <span class="token keyword">public</span> <span class="token keyword">final</span> K <span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">return</span> key<span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    

        <span class="token keyword">public</span> <span class="token keyword">final</span> V <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">return</span> value<span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    

        <span class="token keyword">public</span> <span class="token keyword">final</span> V <span class="token function">setValue</span><span class="token punctuation">(</span>V newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            V oldValue <span class="token operator">=</span> value<span class="token punctuation">;</span>    
            value <span class="token operator">=</span> newValue<span class="token punctuation">;</span>    
            <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    

        <span class="token comment" spellcheck="true">// 判断两个Entry是否相等    </span>
        <span class="token comment" spellcheck="true">// 若两个Entry的“key”和“value”都相等，则返回true。    </span>
        <span class="token comment" spellcheck="true">// 否则，返回false    </span>
        <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span>Object o<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>o <span class="token keyword">instanceof</span> <span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    
            Map<span class="token punctuation">.</span>Entry e <span class="token operator">=</span> <span class="token punctuation">(</span>Map<span class="token punctuation">.</span>Entry<span class="token punctuation">)</span>o<span class="token punctuation">;</span>    
            Object k1 <span class="token operator">=</span> <span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
            Object k2 <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
            <span class="token keyword">if</span> <span class="token punctuation">(</span>k1 <span class="token operator">==</span> k2 <span class="token operator">||</span> <span class="token punctuation">(</span>k1 <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> k1<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
                Object v1 <span class="token operator">=</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
                Object v2 <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
                <span class="token keyword">if</span> <span class="token punctuation">(</span>v1 <span class="token operator">==</span> v2 <span class="token operator">||</span> <span class="token punctuation">(</span>v1 <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> v1<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>v2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    
                    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    
            <span class="token punctuation">}</span>    
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    

        <span class="token comment" spellcheck="true">// 实现hashCode()    </span>
        <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">return</span> <span class="token punctuation">(</span>key<span class="token operator">==</span>null   <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> key<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">^</span>    
                   <span class="token punctuation">(</span>value<span class="token operator">==</span>null <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> value<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    

        <span class="token keyword">public</span> <span class="token keyword">final</span> String <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">return</span> <span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"="</span> <span class="token operator">+</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    

        <span class="token comment" spellcheck="true">// 当向HashMap中添加元素时，绘调用recordAccess()。    </span>
        <span class="token comment" spellcheck="true">// 这里不做任何处理    </span>
        <span class="token keyword">void</span> <span class="token function">recordAccess</span><span class="token punctuation">(</span>HashMap<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span> m<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token punctuation">}</span>    

        <span class="token comment" spellcheck="true">// 当从HashMap中删除元素时，绘调用recordRemoval()。    </span>
        <span class="token comment" spellcheck="true">// 这里不做任何处理    </span>
        <span class="token keyword">void</span> <span class="token function">recordRemoval</span><span class="token punctuation">(</span>HashMap<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span> m<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token punctuation">}</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 新增Entry。将“key-value”插入指定位置，bucketIndex是位置索引。    </span>
    <span class="token keyword">void</span> <span class="token function">addEntry</span><span class="token punctuation">(</span><span class="token keyword">int</span> hash<span class="token punctuation">,</span> K key<span class="token punctuation">,</span> V value<span class="token punctuation">,</span> <span class="token keyword">int</span> bucketIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token comment" spellcheck="true">// 保存“bucketIndex”位置的值到“e”中    </span>
        Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span> e <span class="token operator">=</span> table<span class="token punctuation">[</span>bucketIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>    
        <span class="token comment" spellcheck="true">// 设置“bucketIndex”位置的元素为“新Entry”，    </span>
        <span class="token comment" spellcheck="true">// 设置“e”为“新Entry的下一个节点”    </span>
        table<span class="token punctuation">[</span>bucketIndex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Entry</span><span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token comment" spellcheck="true">// 若HashMap的实际大小 不小于 “阈值”，则调整HashMap的大小    </span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>size<span class="token operator">++</span> <span class="token operator">>=</span> threshold<span class="token punctuation">)</span>    
            <span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> table<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 创建Entry。将“key-value”插入指定位置。    </span>
    <span class="token keyword">void</span> <span class="token function">createEntry</span><span class="token punctuation">(</span><span class="token keyword">int</span> hash<span class="token punctuation">,</span> K key<span class="token punctuation">,</span> V value<span class="token punctuation">,</span> <span class="token keyword">int</span> bucketIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token comment" spellcheck="true">// 保存“bucketIndex”位置的值到“e”中    </span>
        Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span> e <span class="token operator">=</span> table<span class="token punctuation">[</span>bucketIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>    
        <span class="token comment" spellcheck="true">// 设置“bucketIndex”位置的元素为“新Entry”，    </span>
        <span class="token comment" spellcheck="true">// 设置“e”为“新Entry的下一个节点”    </span>
        table<span class="token punctuation">[</span>bucketIndex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Entry</span><span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        size<span class="token operator">++</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// HashIterator是HashMap迭代器的抽象出来的父类，实现了公共了函数。    </span>
    <span class="token comment" spellcheck="true">// 它包含“key迭代器(KeyIterator)”、“Value迭代器(ValueIterator)”和“Entry迭代器(EntryIterator)”3个子类。    </span>
    <span class="token keyword">private</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">HashIterator</span><span class="token operator">&lt;</span>E<span class="token operator">></span> <span class="token keyword">implements</span> <span class="token class-name">Iterator</span><span class="token operator">&lt;</span>E<span class="token operator">></span> <span class="token punctuation">{</span>    
        <span class="token comment" spellcheck="true">// 下一个元素    </span>
        Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span> next<span class="token punctuation">;</span>    
        <span class="token comment" spellcheck="true">// expectedModCount用于实现fast-fail机制。    </span>
        <span class="token keyword">int</span> expectedModCount<span class="token punctuation">;</span>    
        <span class="token comment" spellcheck="true">// 当前索引    </span>
        <span class="token keyword">int</span> index<span class="token punctuation">;</span>    
        <span class="token comment" spellcheck="true">// 当前元素    </span>
        Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span> current<span class="token punctuation">;</span>    

        <span class="token function">HashIterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            expectedModCount <span class="token operator">=</span> modCount<span class="token punctuation">;</span>    
            <span class="token keyword">if</span> <span class="token punctuation">(</span>size <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// advance to first entry    </span>
                Entry<span class="token punctuation">[</span><span class="token punctuation">]</span> t <span class="token operator">=</span> table<span class="token punctuation">;</span>    
                <span class="token comment" spellcheck="true">// 将next指向table中第一个不为null的元素。    </span>
                <span class="token comment" spellcheck="true">// 这里利用了index的初始值为0，从0开始依次向后遍历，直到找到不为null的元素就退出循环。    </span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> t<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>next <span class="token operator">=</span> t<span class="token punctuation">[</span>index<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> null<span class="token punctuation">)</span>    
                    <span class="token punctuation">;</span>    
            <span class="token punctuation">}</span>    
        <span class="token punctuation">}</span>    

        <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">return</span> next <span class="token operator">!=</span> null<span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    

        <span class="token comment" spellcheck="true">// 获取下一个元素    </span>
        <span class="token keyword">final</span> Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span> <span class="token function">nextEntry</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">if</span> <span class="token punctuation">(</span>modCount <span class="token operator">!=</span> expectedModCount<span class="token punctuation">)</span>    
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentModificationException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
            Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span> e <span class="token operator">=</span> next<span class="token punctuation">;</span>    
            <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">==</span> null<span class="token punctuation">)</span>    
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NoSuchElementException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    

            <span class="token comment" spellcheck="true">// 注意！！！    </span>
            <span class="token comment" spellcheck="true">// 一个Entry就是一个单向链表    </span>
            <span class="token comment" spellcheck="true">// 若该Entry的下一个节点不为空，就将next指向下一个节点;    </span>
            <span class="token comment" spellcheck="true">// 否则，将next指向下一个链表(也是下一个Entry)的不为null的节点。    </span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>next <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
                Entry<span class="token punctuation">[</span><span class="token punctuation">]</span> t <span class="token operator">=</span> table<span class="token punctuation">;</span>    
                <span class="token keyword">while</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> t<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>next <span class="token operator">=</span> t<span class="token punctuation">[</span>index<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> null<span class="token punctuation">)</span>    
                    <span class="token punctuation">;</span>    
            <span class="token punctuation">}</span>    
            current <span class="token operator">=</span> e<span class="token punctuation">;</span>    
            <span class="token keyword">return</span> e<span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    

        <span class="token comment" spellcheck="true">// 删除当前元素    </span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">if</span> <span class="token punctuation">(</span>current <span class="token operator">==</span> null<span class="token punctuation">)</span>    
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
            <span class="token keyword">if</span> <span class="token punctuation">(</span>modCount <span class="token operator">!=</span> expectedModCount<span class="token punctuation">)</span>    
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentModificationException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
            Object k <span class="token operator">=</span> current<span class="token punctuation">.</span>key<span class="token punctuation">;</span>    
            current <span class="token operator">=</span> null<span class="token punctuation">;</span>    
            HashMap<span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">removeEntryForKey</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>    
            expectedModCount <span class="token operator">=</span> modCount<span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    

    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// value的迭代器    </span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">ValueIterator</span> <span class="token keyword">extends</span> <span class="token class-name">HashIterator</span><span class="token operator">&lt;</span>V<span class="token operator">></span> <span class="token punctuation">{</span>    
        <span class="token keyword">public</span> V <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">return</span> <span class="token function">nextEntry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// key的迭代器    </span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">KeyIterator</span> <span class="token keyword">extends</span> <span class="token class-name">HashIterator</span><span class="token operator">&lt;</span>K<span class="token operator">></span> <span class="token punctuation">{</span>    
        <span class="token keyword">public</span> K <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">return</span> <span class="token function">nextEntry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// Entry的迭代器    </span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">EntryIterator</span> <span class="token keyword">extends</span> <span class="token class-name">HashIterator</span><span class="token operator">&lt;</span>Map<span class="token punctuation">.</span>Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">>></span> <span class="token punctuation">{</span>    
        <span class="token keyword">public</span> Map<span class="token punctuation">.</span>Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">return</span> <span class="token function">nextEntry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 返回一个“key迭代器”    </span>
    Iterator<span class="token operator">&lt;</span>K<span class="token operator">></span> <span class="token function">newKeyIterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token punctuation">{</span>    
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">KeyIterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    
    <span class="token comment" spellcheck="true">// 返回一个“value迭代器”    </span>
    Iterator<span class="token operator">&lt;</span>V<span class="token operator">></span> <span class="token function">newValueIterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token punctuation">{</span>    
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ValueIterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    
    <span class="token comment" spellcheck="true">// 返回一个“entry迭代器”    </span>
    Iterator<span class="token operator">&lt;</span>Map<span class="token punctuation">.</span>Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">>></span> <span class="token function">newEntryIterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token punctuation">{</span>    
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">EntryIterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// HashMap的Entry对应的集合    </span>
    <span class="token keyword">private</span> <span class="token keyword">transient</span> Set<span class="token operator">&lt;</span>Map<span class="token punctuation">.</span>Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">>></span> entrySet <span class="token operator">=</span> null<span class="token punctuation">;</span>    

    <span class="token comment" spellcheck="true">// 返回“key的集合”，实际上返回一个“KeySet对象”    </span>
    <span class="token keyword">public</span> Set<span class="token operator">&lt;</span>K<span class="token operator">></span> <span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        Set<span class="token operator">&lt;</span>K<span class="token operator">></span> ks <span class="token operator">=</span> keySet<span class="token punctuation">;</span>    
        <span class="token keyword">return</span> <span class="token punctuation">(</span>ks <span class="token operator">!=</span> null <span class="token operator">?</span> ks <span class="token operator">:</span> <span class="token punctuation">(</span>keySet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KeySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// Key对应的集合    </span>
    <span class="token comment" spellcheck="true">// KeySet继承于AbstractSet，说明该集合中没有重复的Key。    </span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">KeySet</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractSet</span><span class="token operator">&lt;</span>K<span class="token operator">></span> <span class="token punctuation">{</span>    
        <span class="token keyword">public</span> Iterator<span class="token operator">&lt;</span>K<span class="token operator">></span> <span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">return</span> <span class="token function">newKeyIterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    
        <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">return</span> size<span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    
        <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">contains</span><span class="token punctuation">(</span>Object o<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">return</span> <span class="token function">containsKey</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    
        <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">remove</span><span class="token punctuation">(</span>Object o<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">return</span> HashMap<span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">removeEntryForKey</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token operator">!=</span> null<span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            HashMap<span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 返回“value集合”，实际上返回的是一个Values对象    </span>
    <span class="token keyword">public</span> Collection<span class="token operator">&lt;</span>V<span class="token operator">></span> <span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        Collection<span class="token operator">&lt;</span>V<span class="token operator">></span> vs <span class="token operator">=</span> values<span class="token punctuation">;</span>    
        <span class="token keyword">return</span> <span class="token punctuation">(</span>vs <span class="token operator">!=</span> null <span class="token operator">?</span> vs <span class="token operator">:</span> <span class="token punctuation">(</span>values <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// “value集合”    </span>
    <span class="token comment" spellcheck="true">// Values继承于AbstractCollection，不同于“KeySet继承于AbstractSet”，    </span>
    <span class="token comment" spellcheck="true">// Values中的元素能够重复。因为不同的key可以指向相同的value。    </span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Values</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractCollection</span><span class="token operator">&lt;</span>V<span class="token operator">></span> <span class="token punctuation">{</span>    
        <span class="token keyword">public</span> Iterator<span class="token operator">&lt;</span>V<span class="token operator">></span> <span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">return</span> <span class="token function">newValueIterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    
        <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">return</span> size<span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    
        <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">contains</span><span class="token punctuation">(</span>Object o<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">return</span> <span class="token function">containsValue</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            HashMap<span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 返回“HashMap的Entry集合”    </span>
    <span class="token keyword">public</span> Set<span class="token operator">&lt;</span>Map<span class="token punctuation">.</span>Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">>></span> <span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">return</span> <span class="token function">entrySet0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 返回“HashMap的Entry集合”，它实际是返回一个EntrySet对象    </span>
    <span class="token keyword">private</span> Set<span class="token operator">&lt;</span>Map<span class="token punctuation">.</span>Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">>></span> <span class="token function">entrySet0</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        Set<span class="token operator">&lt;</span>Map<span class="token punctuation">.</span>Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">>></span> es <span class="token operator">=</span> entrySet<span class="token punctuation">;</span>    
        <span class="token keyword">return</span> es <span class="token operator">!=</span> null <span class="token operator">?</span> es <span class="token operator">:</span> <span class="token punctuation">(</span>entrySet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EntrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// EntrySet对应的集合    </span>
    <span class="token comment" spellcheck="true">// EntrySet继承于AbstractSet，说明该集合中没有重复的EntrySet。    </span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">EntrySet</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractSet</span><span class="token operator">&lt;</span>Map<span class="token punctuation">.</span>Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">>></span> <span class="token punctuation">{</span>    
        <span class="token keyword">public</span> Iterator<span class="token operator">&lt;</span>Map<span class="token punctuation">.</span>Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">>></span> <span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">return</span> <span class="token function">newEntryIterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    
        <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">contains</span><span class="token punctuation">(</span>Object o<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>o <span class="token keyword">instanceof</span> <span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    
            Map<span class="token punctuation">.</span>Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span> e <span class="token operator">=</span> <span class="token punctuation">(</span>Map<span class="token punctuation">.</span>Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span><span class="token punctuation">)</span> o<span class="token punctuation">;</span>    
            Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span> candidate <span class="token operator">=</span> <span class="token function">getEntry</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
            <span class="token keyword">return</span> candidate <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> candidate<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    
        <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">remove</span><span class="token punctuation">(</span>Object o<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">return</span> <span class="token function">removeMapping</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token operator">!=</span> null<span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    
        <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">return</span> size<span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            HashMap<span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// java.io.Serializable的写入函数    </span>
    <span class="token comment" spellcheck="true">// 将HashMap的“总的容量，实际容量，所有的Entry”都写入到输出流中    </span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">writeObject</span><span class="token punctuation">(</span>java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>ObjectOutputStream s<span class="token punctuation">)</span>    
        <span class="token keyword">throws</span> IOException    
    <span class="token punctuation">{</span>    
        Iterator<span class="token operator">&lt;</span>Map<span class="token punctuation">.</span>Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">>></span> i <span class="token operator">=</span>    
            <span class="token punctuation">(</span>size <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">entrySet0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> null<span class="token punctuation">;</span>    

        <span class="token comment" spellcheck="true">// Write out the threshold, loadfactor, and any hidden stuff    </span>
        s<span class="token punctuation">.</span><span class="token function">defaultWriteObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    

        <span class="token comment" spellcheck="true">// Write out number of buckets    </span>
        s<span class="token punctuation">.</span><span class="token function">writeInt</span><span class="token punctuation">(</span>table<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>    

        <span class="token comment" spellcheck="true">// Write out size (number of Mappings)    </span>
        s<span class="token punctuation">.</span><span class="token function">writeInt</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>    

        <span class="token comment" spellcheck="true">// Write out keys and values (alternating)    </span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            Map<span class="token punctuation">.</span>Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span> e <span class="token operator">=</span> i<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
            s<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
            s<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
            <span class="token punctuation">}</span>    
        <span class="token punctuation">}</span>    
    <span class="token punctuation">}</span>    


    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> 362498820763181265L<span class="token punctuation">;</span>    

    <span class="token comment" spellcheck="true">// java.io.Serializable的读取函数：根据写入方式读出    </span>
    <span class="token comment" spellcheck="true">// 将HashMap的“总的容量，实际容量，所有的Entry”依次读出    </span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">readObject</span><span class="token punctuation">(</span>java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>ObjectInputStream s<span class="token punctuation">)</span>    
         <span class="token keyword">throws</span> IOException<span class="token punctuation">,</span> ClassNotFoundException    
    <span class="token punctuation">{</span>    
        <span class="token comment" spellcheck="true">// Read in the threshold, loadfactor, and any hidden stuff    </span>
        s<span class="token punctuation">.</span><span class="token function">defaultReadObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    

        <span class="token comment" spellcheck="true">// Read in number of buckets and allocate the bucket array;    </span>
        <span class="token keyword">int</span> numBuckets <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        table <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Entry</span><span class="token punctuation">[</span>numBuckets<span class="token punctuation">]</span><span class="token punctuation">;</span>    

        <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// Give subclass a chance to do its thing.    </span>

        <span class="token comment" spellcheck="true">// Read in size (number of Mappings)    </span>
        <span class="token keyword">int</span> size <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    

        <span class="token comment" spellcheck="true">// Read the keys and values, and put the mappings in the HashMap    </span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            K key <span class="token operator">=</span> <span class="token punctuation">(</span>K<span class="token punctuation">)</span> s<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
            V value <span class="token operator">=</span> <span class="token punctuation">(</span>V<span class="token punctuation">)</span> s<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
            <span class="token function">putForCreate</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 返回“HashMap总的容量”    </span>
    <span class="token keyword">int</span>   <span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span>     <span class="token punctuation">{</span> <span class="token keyword">return</span> table<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token punctuation">}</span>    
    <span class="token comment" spellcheck="true">// 返回“HashMap的加载因子”    </span>
    <span class="token keyword">float</span> <span class="token function">loadFactor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token punctuation">{</span> <span class="token keyword">return</span> loadFactor<span class="token punctuation">;</span>   <span class="token punctuation">}</span>    
<span class="token punctuation">}</span>   </code></pre>
<hr>
<h1 id="HashTable"><a href="#HashTable" class="headerlink" title="HashTable"></a>HashTable</h1><p>基于哈希表实现，每个元素都是key-value对，内部通过单链表解决冲突问题，容量不足时，自动增长</p>
<p>是线程安全的，能用于多线程</p>
<p>实现了Serializable接口，支持序列号</p>
<p>实现了Cloneable接口，能被克隆</p>
<pre class=" language-Java"><code class="language-Java">package java.util;    
import java.io.*;    

public class Hashtable<K,V>    
    extends Dictionary<K,V>    
    implements Map<K,V>, Cloneable, java.io.Serializable {    

    // 保存key-value的数组。    
    // Hashtable同样采用单链表解决冲突，每一个Entry本质上是一个单向链表    
    private transient Entry[] table;    

    // Hashtable中键值对的数量    
    private transient int count;    

    // 阈值，用于判断是否需要调整Hashtable的容量（threshold = 容量*加载因子）    
    private int threshold;    

    // 加载因子    
    private float loadFactor;    

    // Hashtable被改变的次数，用于fail-fast机制的实现    
    private transient int modCount = 0;    

    // 序列版本号    
    private static final long serialVersionUID = 1421746759512286392L;    

    // 指定“容量大小”和“加载因子”的构造函数    
    public Hashtable(int initialCapacity, float loadFactor) {    
        if (initialCapacity < 0)    
            throw new IllegalArgumentException("Illegal Capacity: "+    
                                               initialCapacity);    
        if (loadFactor <= 0 || Float.isNaN(loadFactor))    
            throw new IllegalArgumentException("Illegal Load: "+loadFactor);    

        if (initialCapacity==0)    
            initialCapacity = 1;    
        this.loadFactor = loadFactor;    
        table = new Entry[initialCapacity];    
        threshold = (int)(initialCapacity * loadFactor);    
    }    

    // 指定“容量大小”的构造函数    
    public Hashtable(int initialCapacity) {    
        this(initialCapacity, 0.75f);    
    }    

    // 默认构造函数。    
    public Hashtable() {    
        // 默认构造函数，指定的容量大小是11；加载因子是0.75    
        this(11, 0.75f);    
    }    

    // 包含“子Map”的构造函数    
    public Hashtable(Map<? extends K, ? extends V> t) {    
        this(Math.max(2*t.size(), 11), 0.75f);    
        // 将“子Map”的全部元素都添加到Hashtable中    
        putAll(t);    
    }    

    private int hash(Object k) {
        if (useAltHashing) {
            if (k.getClass() == String.class) {
                return sun.misc.Hashing.stringHash32((String) k);
            } else {
                int h = hashSeed ^ k.hashCode();

                // This function ensures that hashCodes that differ only by
                // constant multiples at each bit position have a bounded
                // number of collisions (approximately 8 at default load factor).
                h ^= (h >>> 20) ^ (h >>> 12);
                return h ^ (h >>> 7) ^ (h >>> 4);
             }
        } else  {
            return k.hashCode();
        }
    }

    public synchronized int size() {    
        return count;    
    }    

    public synchronized boolean isEmpty() {    
        return count == 0;    
    }    

    // 返回“所有key”的枚举对象    
    public synchronized Enumeration<K> keys() {    
        return this.<K>getEnumeration(KEYS);    
    }    

    // 返回“所有value”的枚举对象    
    public synchronized Enumeration<V> elements() {    
        return this.<V>getEnumeration(VALUES);    
    }    

    // 判断Hashtable是否包含“值(value)”    
    public synchronized boolean contains(Object value) {    
        //注意，Hashtable中的value不能是null，    
        // 若是null的话，抛出异常!    
        if (value == null) {    
            throw new NullPointerException();    
        }    

        // 从后向前遍历table数组中的元素(Entry)    
        // 对于每个Entry(单向链表)，逐个遍历，判断节点的值是否等于value    
        Entry tab[] = table;    
        for (int i = tab.length ; i-- > 0 ;) {    
            for (Entry<K,V> e = tab[i] ; e != null ; e = e.next) {    
                if (e.value.equals(value)) {    
                    return true;    
                }    
            }    
        }    
        return false;    
    }    

    public boolean containsValue(Object value) {    
        return contains(value);    
    }    

    // 判断Hashtable是否包含key    
    public synchronized boolean containsKey(Object key) {    
        Entry tab[] = table;    
        //计算hash值，直接用key的hashCode代替  
        int hash = key.hashCode();      
        // 计算在数组中的索引值   
        int index = (hash & 0x7FFFFFFF) % tab.length;    
        // 找到“key对应的Entry(链表)”，然后在链表中找出“哈希值”和“键值”与key都相等的元素    
        for (Entry<K,V> e = tab[index] ; e != null ; e = e.next) {    
            if ((e.hash == hash) && e.key.equals(key)) {    
                return true;    
            }    
        }    
        return false;    
    }    

    // 返回key对应的value，没有的话返回null    
    public synchronized V get(Object key) {    
        Entry tab[] = table;    
        int hash = hash(key);
        // 计算索引值，    
        int index = (hash & 0x7FFFFFFF) % tab.length;    
        // 找到“key对应的Entry(链表)”，然后在链表中找出“哈希值”和“键值”与key都相等的元素    
        for (Entry<K,V> e = tab[index] ; e != null ; e = e.next) {    
            if ((e.hash == hash) && e.key.equals(key)) {    
                return e.value;    
            }    
        }    
        return null;    
    }    

    // 调整Hashtable的长度，将长度变成原来的2倍+1   
    protected void rehash() {    
        int oldCapacity = table.length;    
        Entry[] oldMap = table;    

        //创建新容量大小的Entry数组  
        int newCapacity = oldCapacity * 2 + 1;    
        Entry[] newMap = new Entry[newCapacity];    

        modCount++;    
        threshold = (int)(newCapacity * loadFactor);    
        table = newMap;    

        //将“旧的Hashtable”中的元素复制到“新的Hashtable”中  
        for (int i = oldCapacity ; i-- > 0 ;) {    
            for (Entry<K,V> old = oldMap[i] ; old != null ; ) {    
                Entry<K,V> e = old;    
                old = old.next;    
                //重新计算index  
                int index = (e.hash & 0x7FFFFFFF) % newCapacity;    
                e.next = newMap[index];    
                newMap[index] = e;    
            }    
        }    
    }    

    // 将“key-value”添加到Hashtable中    
    public synchronized V put(K key, V value) {    
        // Hashtable中不能插入value为null的元素！！！    
        if (value == null) {    
            throw new NullPointerException();    
        }    

        // 若“Hashtable中已存在键为key的键值对”，    
        // 则用“新的value”替换“旧的value”    
        Entry tab[] = table;    
        int hash = hash(key);
        int index = (hash & 0x7FFFFFFF) % tab.length;    
        for (Entry<K,V> e = tab[index] ; e != null ; e = e.next) {    
            if ((e.hash == hash) && e.key.equals(key)) {    
                V old = e.value;    
                e.value = value;    
                return old;    
                }    
        }    

        // 若“Hashtable中不存在键为key的键值对”，  
        // 将“修改统计数”+1    
        modCount++;    
        //  若“Hashtable实际容量” > “阈值”(阈值=总的容量 * 加载因子)    
        //  则调整Hashtable的大小    
        if (count >= threshold) {  
            rehash();    

            tab = table;    
            index = (hash & 0x7FFFFFFF) % tab.length;    
        }    

        //将新的key-value对插入到tab[index]处（即链表的头结点）  
        Entry<K,V> e = tab[index];           
        tab[index] = new Entry<K,V>(hash, key, value, e);    
        count++;    
        return null;    
    }    

    // 删除Hashtable中键为key的元素    
    public synchronized V remove(Object key) {    
        Entry tab[] = table;    
        int hash = hash(key);
        int index = (hash & 0x7FFFFFFF) % tab.length;    

        //从table[index]链表中找出要删除的节点，并删除该节点。  
        //因为是单链表，因此要保留带删节点的前一个节点，才能有效地删除节点  
        for (Entry<K,V> e = tab[index], prev = null ; e != null ; prev = e, e = e.next) {    
            if ((e.hash == hash) && e.key.equals(key)) {    
                modCount++;    
                if (prev != null) {    
                    prev.next = e.next;    
                } else {    
                    tab[index] = e.next;    
                }    
                count--;    
                V oldValue = e.value;    
                e.value = null;    
                return oldValue;    
            }    
        }    
        return null;    
    }    

    // 将“Map(t)”的中全部元素逐一添加到Hashtable中    
    public synchronized void putAll(Map<? extends K, ? extends V> t) {    
        for (Map.Entry<? extends K, ? extends V> e : t.entrySet())    
            put(e.getKey(), e.getValue());    
    }    

    // 清空Hashtable    
    // 将Hashtable的table数组的值全部设为null    
    public synchronized void clear() {    
        Entry tab[] = table;    
        modCount++;    
        for (int index = tab.length; --index >= 0; )    
            tab[index] = null;    
        count = 0;    
    }    

    // 克隆一个Hashtable，并以Object的形式返回。    
    public synchronized Object clone() {    
        try {    
            Hashtable<K,V> t = (Hashtable<K,V>) super.clone();    
            t.table = new Entry[table.length];    
            for (int i = table.length ; i-- > 0 ; ) {    
                t.table[i] = (table[i] != null)    
                ? (Entry<K,V>) table[i].clone() : null;    
            }    
            t.keySet = null;    
            t.entrySet = null;    
            t.values = null;    
            t.modCount = 0;    
            return t;    
        } catch (CloneNotSupportedException e) {     
            throw new InternalError();    
        }    
    }    

    public synchronized String toString() {    
        int max = size() - 1;    
        if (max == -1)    
            return "{}";    

        StringBuilder sb = new StringBuilder();    
        Iterator<Map.Entry<K,V>> it = entrySet().iterator();    

        sb.append('{');    
        for (int i = 0; ; i++) {    
            Map.Entry<K,V> e = it.next();    
            K key = e.getKey();    
            V value = e.getValue();    
            sb.append(key   == this ? "(this Map)" : key.toString());    
            sb.append('=');    
            sb.append(value == this ? "(this Map)" : value.toString());    

            if (i == max)    
                return sb.append('}').toString();    
            sb.append(", ");    
        }    
    }    

    // 获取Hashtable的枚举类对象    
    // 若Hashtable的实际大小为0,则返回“空枚举类”对象；    
    // 否则，返回正常的Enumerator的对象。   
    private <T> Enumeration<T> getEnumeration(int type) {    
    if (count == 0) {    
        return (Enumeration<T>)emptyEnumerator;    
    } else {    
        return new Enumerator<T>(type, false);    
    }    
    }    

    // 获取Hashtable的迭代器    
    // 若Hashtable的实际大小为0,则返回“空迭代器”对象；    
    // 否则，返回正常的Enumerator的对象。(Enumerator实现了迭代器和枚举两个接口)    
    private <T> Iterator<T> getIterator(int type) {    
        if (count == 0) {    
            return (Iterator<T>) emptyIterator;    
        } else {    
            return new Enumerator<T>(type, true);    
        }    
    }    

    // Hashtable的“key的集合”。它是一个Set，没有重复元素    
    private transient volatile Set<K> keySet = null;    
    // Hashtable的“key-value的集合”。它是一个Set，没有重复元素    
    private transient volatile Set<Map.Entry<K,V>> entrySet = null;    
    // Hashtable的“key-value的集合”。它是一个Collection，可以有重复元素    
    private transient volatile Collection<V> values = null;    

    // 返回一个被synchronizedSet封装后的KeySet对象    
    // synchronizedSet封装的目的是对KeySet的所有方法都添加synchronized，实现多线程同步    
    public Set<K> keySet() {    
        if (keySet == null)    
            keySet = Collections.synchronizedSet(new KeySet(), this);    
        return keySet;    
    }    

    // Hashtable的Key的Set集合。    
    // KeySet继承于AbstractSet，所以，KeySet中的元素没有重复的。    
    private class KeySet extends AbstractSet<K> {    
        public Iterator<K> iterator() {    
            return getIterator(KEYS);    
        }    
        public int size() {    
            return count;    
        }    
        public boolean contains(Object o) {    
            return containsKey(o);    
        }    
        public boolean remove(Object o) {    
            return Hashtable.this.remove(o) != null;    
        }    
        public void clear() {    
            Hashtable.this.clear();    
        }    
    }    

    // 返回一个被synchronizedSet封装后的EntrySet对象    
    // synchronizedSet封装的目的是对EntrySet的所有方法都添加synchronized，实现多线程同步    
    public Set<Map.Entry<K,V>> entrySet() {    
        if (entrySet==null)    
            entrySet = Collections.synchronizedSet(new EntrySet(), this);    
        return entrySet;    
    }    

    // Hashtable的Entry的Set集合。    
    // EntrySet继承于AbstractSet，所以，EntrySet中的元素没有重复的。    
    private class EntrySet extends AbstractSet<Map.Entry<K,V>> {    
        public Iterator<Map.Entry<K,V>> iterator() {    
            return getIterator(ENTRIES);    
        }    

        public boolean add(Map.Entry<K,V> o) {    
            return super.add(o);    
        }    

        // 查找EntrySet中是否包含Object(0)    
        // 首先，在table中找到o对应的Entry链表    
        // 然后，查找Entry链表中是否存在Object    
        public boolean contains(Object o) {    
            if (!(o instanceof Map.Entry))    
                return false;    
            Map.Entry entry = (Map.Entry)o;    
            Object key = entry.getKey();    
            Entry[] tab = table;    
            int hash = hash(key);
            int index = (hash & 0x7FFFFFFF) % tab.length;    

            for (Entry e = tab[index]; e != null; e = e.next)    
                if (e.hash==hash && e.equals(entry))    
                    return true;    
            return false;    
        }    

        // 删除元素Object(0)    
        // 首先，在table中找到o对应的Entry链表  
        // 然后，删除链表中的元素Object    
        public boolean remove(Object o) {    
            if (!(o instanceof Map.Entry))    
                return false;    
            Map.Entry<K,V> entry = (Map.Entry<K,V>) o;    
            K key = entry.getKey();    
            Entry[] tab = table;    
            int hash = hash(key);
            int index = (hash & 0x7FFFFFFF) % tab.length;    

            for (Entry<K,V> e = tab[index], prev = null; e != null;    
                 prev = e, e = e.next) {    
                if (e.hash==hash && e.equals(entry)) {    
                    modCount++;    
                    if (prev != null)    
                        prev.next = e.next;    
                    else   
                        tab[index] = e.next;    

                    count--;    
                    e.value = null;    
                    return true;    
                }    
            }    
            return false;    
        }    

        public int size() {    
            return count;    
        }    

        public void clear() {    
            Hashtable.this.clear();    
        }    
    }    

    // 返回一个被synchronizedCollection封装后的ValueCollection对象    
    // synchronizedCollection封装的目的是对ValueCollection的所有方法都添加synchronized，实现多线程同步    
    public Collection<V> values() {    
    if (values==null)    
        values = Collections.synchronizedCollection(new ValueCollection(),    
                                                        this);    
        return values;    
    }    

    // Hashtable的value的Collection集合。    
    // ValueCollection继承于AbstractCollection，所以，ValueCollection中的元素可以重复的。    
    private class ValueCollection extends AbstractCollection<V> {    
        public Iterator<V> iterator() {    
        return getIterator(VALUES);    
        }    
        public int size() {    
            return count;    
        }    
        public boolean contains(Object o) {    
            return containsValue(o);    
        }    
        public void clear() {    
            Hashtable.this.clear();    
        }    
    }    

    // 重新equals()函数    
    // 若两个Hashtable的所有key-value键值对都相等，则判断它们两个相等    
    public synchronized boolean equals(Object o) {    
        if (o == this)    
            return true;    

        if (!(o instanceof Map))    
            return false;    
        Map<K,V> t = (Map<K,V>) o;    
        if (t.size() != size())    
            return false;    

        try {    
            // 通过迭代器依次取出当前Hashtable的key-value键值对    
            // 并判断该键值对，存在于Hashtable中。    
            // 若不存在，则立即返回false；否则，遍历完“当前Hashtable”并返回true。    
            Iterator<Map.Entry<K,V>> i = entrySet().iterator();    
            while (i.hasNext()) {    
                Map.Entry<K,V> e = i.next();    
                K key = e.getKey();    
                V value = e.getValue();    
                if (value == null) {    
                    if (!(t.get(key)==null && t.containsKey(key)))    
                        return false;    
                } else {    
                    if (!value.equals(t.get(key)))    
                        return false;    
                }    
            }    
        } catch (ClassCastException unused)   {    
            return false;    
        } catch (NullPointerException unused) {    
            return false;    
        }    

        return true;    
    }    

    // 计算Entry的hashCode    
    // 若 Hashtable的实际大小为0 或者 加载因子<0，则返回0。    
    // 否则，返回“Hashtable中的每个Entry的key和value的异或值 的总和”。    
    public synchronized int hashCode() {    
        int h = 0;    
        if (count == 0 || loadFactor < 0)    
            return h;  // Returns zero    

        loadFactor = -loadFactor;  // Mark hashCode computation in progress    
        Entry[] tab = table;    
        for (int i = 0; i < tab.length; i++)    
            for (Entry e = tab[i]; e != null; e = e.next)    
                h += e.key.hashCode() ^ e.value.hashCode();    
        loadFactor = -loadFactor;  // Mark hashCode computation complete    

        return h;    
    }    

    // java.io.Serializable的写入函数    
    // 将Hashtable的“总的容量，实际容量，所有的Entry”都写入到输出流中    
    private synchronized void writeObject(java.io.ObjectOutputStream s)    
        throws IOException    
    {    
        // Write out the length, threshold, loadfactor    
        s.defaultWriteObject();    

        // Write out length, count of elements and then the key/value objects    
        s.writeInt(table.length);    
        s.writeInt(count);    
        for (int index = table.length-1; index >= 0; index--) {    
            Entry entry = table[index];    

            while (entry != null) {    
            s.writeObject(entry.key);    
            s.writeObject(entry.value);    
            entry = entry.next;    
            }    
        }    
    }    

    // java.io.Serializable的读取函数：根据写入方式读出    
    // 将Hashtable的“总的容量，实际容量，所有的Entry”依次读出    
    private void readObject(java.io.ObjectInputStream s)    
         throws IOException, ClassNotFoundException    
    {    
        // Read in the length, threshold, and loadfactor    
        s.defaultReadObject();    

        // Read the original length of the array and number of elements    
        int origlength = s.readInt();    
        int elements = s.readInt();    

        // Compute new size with a bit of room 5% to grow but    
        // no larger than the original size.  Make the length    
        // odd if it's large enough, this helps distribute the entries.    
        // Guard against the length ending up zero, that's not valid.    
        int length = (int)(elements * loadFactor) + (elements / 20) + 3;    
        if (length > elements && (length & 1) == 0)    
            length--;    
        if (origlength > 0 && length > origlength)    
            length = origlength;    

        Entry[] table = new Entry[length];    
        count = 0;    

        // Read the number of elements and then all the key/value objects    
        for (; elements > 0; elements--) {    
            K key = (K)s.readObject();    
            V value = (V)s.readObject();    
                // synch could be eliminated for performance    
                reconstitutionPut(table, key, value);    
        }    
        this.table = table;    
    }    

    private void reconstitutionPut(Entry[] tab, K key, V value)    
        throws StreamCorruptedException    
    {    
        if (value == null) {    
            throw new java.io.StreamCorruptedException();    
        }    
        // Makes sure the key is not already in the hashtable.    
        // This should not happen in deserialized version.    
        int hash = key.hashCode();    
        int index = (hash & 0x7FFFFFFF) % tab.length;    
        for (Entry<K,V> e = tab[index] ; e != null ; e = e.next) {    
            if ((e.hash == hash) && e.key.equals(key)) {    
                throw new java.io.StreamCorruptedException();    
            }    
        }    
        // Creates the new entry.    
        Entry<K,V> e = tab[index];    
        tab[index] = new Entry<K,V>(hash, key, value, e);    
        count++;    
    }    

    // Hashtable的Entry节点，它本质上是一个单向链表。    
    // 也因此，我们才能推断出Hashtable是由拉链法实现的散列表    
    private static class Entry<K,V> implements Map.Entry<K,V> {    
        // 哈希值    
        int hash;    
        K key;    
        V value;    
        // 指向的下一个Entry，即链表的下一个节点    
        Entry<K,V> next;    

        // 构造函数    
        protected Entry(int hash, K key, V value, Entry<K,V> next) {    
            this.hash = hash;    
            this.key = key;    
            this.value = value;    
            this.next = next;    
        }    

        protected Object clone() {    
            return new Entry<K,V>(hash, key, value,    
                  (next==null ? null : (Entry<K,V>) next.clone()));    
        }    

        public K getKey() {    
            return key;    
        }    

        public V getValue() {    
            return value;    
        }    

        // 设置value。若value是null，则抛出异常。    
        public V setValue(V value) {    
            if (value == null)    
                throw new NullPointerException();    

            V oldValue = this.value;    
            this.value = value;    
            return oldValue;    
        }    

        // 覆盖equals()方法，判断两个Entry是否相等。    
        // 若两个Entry的key和value都相等，则认为它们相等。    
        public boolean equals(Object o) {    
            if (!(o instanceof Map.Entry))    
                return false;    
            Map.Entry e = (Map.Entry)o;    

            return (key==null ? e.getKey()==null : key.equals(e.getKey())) &&    
               (value==null ? e.getValue()==null : value.equals(e.getValue()));    
        }    

        public int hashCode() {    
            return hash ^ (value==null ? 0 : value.hashCode());    
        }    

        public String toString() {    
            return key.toString()+"="+value.toString();    
        }    
    }    

    private static final int KEYS = 0;    
    private static final int VALUES = 1;    
    private static final int ENTRIES = 2;    

    // Enumerator的作用是提供了“通过elements()遍历Hashtable的接口” 和 “通过entrySet()遍历Hashtable的接口”。    
    private class Enumerator<T> implements Enumeration<T>, Iterator<T> {    
        // 指向Hashtable的table    
        Entry[] table = Hashtable.this.table;    
        // Hashtable的总的大小    
        int index = table.length;    
        Entry<K,V> entry = null;    
        Entry<K,V> lastReturned = null;    
        int type;    

        // Enumerator是 “迭代器(Iterator)” 还是 “枚举类(Enumeration)”的标志    
        // iterator为true，表示它是迭代器；否则，是枚举类。    
        boolean iterator;    

        // 在将Enumerator当作迭代器使用时会用到，用来实现fail-fast机制。    
        protected int expectedModCount = modCount;    

        Enumerator(int type, boolean iterator) {    
            this.type = type;    
            this.iterator = iterator;    
        }    

        // 从遍历table的数组的末尾向前查找，直到找到不为null的Entry。    
        public boolean hasMoreElements() {    
            Entry<K,V> e = entry;    
            int i = index;    
            Entry[] t = table;    
            /* Use locals for faster loop iteration */   
            while (e == null && i > 0) {    
                e = t[--i];    
            }    
            entry = e;    
            index = i;    
            return e != null;    
        }    

        // 获取下一个元素    
        // 注意：从hasMoreElements() 和nextElement() 可以看出“Hashtable的elements()遍历方式”    
        // 首先，从后向前的遍历table数组。table数组的每个节点都是一个单向链表(Entry)。    
        // 然后，依次向后遍历单向链表Entry。    
        public T nextElement() {    
            Entry<K,V> et = entry;    
            int i = index;    
            Entry[] t = table;    
            /* Use locals for faster loop iteration */   
            while (et == null && i > 0) {    
                et = t[--i];    
            }    
            entry = et;    
            index = i;    
            if (et != null) {    
                Entry<K,V> e = lastReturned = entry;    
                entry = e.next;    
                return type == KEYS ? (T)e.key : (type == VALUES ? (T)e.value : (T)e);    
            }    
            throw new NoSuchElementException("Hashtable Enumerator");    
        }    

        // 迭代器Iterator的判断是否存在下一个元素    
        // 实际上，它是调用的hasMoreElements()    
        public boolean hasNext() {    
            return hasMoreElements();    
        }    

        // 迭代器获取下一个元素    
        // 实际上，它是调用的nextElement()    
        public T next() {    
            if (modCount != expectedModCount)    
                throw new ConcurrentModificationException();    
            return nextElement();    
        }    

        // 迭代器的remove()接口。    
        // 首先，它在table数组中找出要删除元素所在的Entry，    
        // 然后，删除单向链表Entry中的元素。    
        public void remove() {    
            if (!iterator)    
                throw new UnsupportedOperationException();    
            if (lastReturned == null)    
                throw new IllegalStateException("Hashtable Enumerator");    
            if (modCount != expectedModCount)    
                throw new ConcurrentModificationException();    

            synchronized(Hashtable.this) {    
                Entry[] tab = Hashtable.this.table;    
                int index = (lastReturned.hash & 0x7FFFFFFF) % tab.length;    

                for (Entry<K,V> e = tab[index], prev = null; e != null;    
                     prev = e, e = e.next) {    
                    if (e == lastReturned) {    
                        modCount++;    
                        expectedModCount++;    
                        if (prev == null)    
                            tab[index] = e.next;    
                        else   
                            prev.next = e.next;    
                        count--;    
                        lastReturned = null;    
                        return;    
                    }    
                }    
                throw new ConcurrentModificationException();    
            }    
        }    
    }    


    private static Enumeration emptyEnumerator = new EmptyEnumerator();    
    private static Iterator emptyIterator = new EmptyIterator();    

    // 空枚举类    
    // 当Hashtable的实际大小为0；此时，又要通过Enumeration遍历Hashtable时，返回的是“空枚举类”的对象。    
    private static class EmptyEnumerator implements Enumeration<Object> {    

        EmptyEnumerator() {    
        }    

        // 空枚举类的hasMoreElements() 始终返回false    
        public boolean hasMoreElements() {    
            return false;    
        }    

        // 空枚举类的nextElement() 抛出异常    
        public Object nextElement() {    
            throw new NoSuchElementException("Hashtable Enumerator");    
        }    
    }    


    // 空迭代器    
    // 当Hashtable的实际大小为0；此时，又要通过迭代器遍历Hashtable时，返回的是“空迭代器”的对象。    
    private static class EmptyIterator implements Iterator<Object> {    

        EmptyIterator() {    
        }    

        public boolean hasNext() {    
            return false;    
        }    

        public Object next() {    
            throw new NoSuchElementException("Hashtable Iterator");    
        }    

        public void remove() {    
            throw new IllegalStateException("Hashtable Iterator");    
        }    

    }    
}   </code></pre>
<hr>
<h1 id="Collection"><a href="#Collection" class="headerlink" title="Collection"></a>Collection</h1><p>是最基本的集合接口</p>
<p>继承的接口：Iterable</p>
<p>子接口：List、Set、Queue等</p>
<p>遍历Collection中的每一个元素</p>
<p>它支持一个Iterator()方法，该方法返回一个迭代子，该迭代子可逐一访问Collection中每一个元素</p>
<pre class=" language-java"><code class="language-java">Iterator it <span class="token operator">=</span> collection<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 获得一个迭代子</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>　　
    <span class="token punctuation">{</span>
        Object obj <span class="token operator">=</span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 得到下一个元素</span>
    <span class="token punctuation">}</span></code></pre>
<p>方法：</p>
<pre class=" language-java"><code class="language-java"><span class="token function">retainAll</span><span class="token punctuation">(</span>Collection<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token keyword">extends</span> <span class="token class-name">E</span><span class="token operator">></span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//保留，交运算</span>
<span class="token function">addAll</span><span class="token punctuation">(</span>Collection<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token keyword">extends</span> <span class="token class-name">E</span><span class="token operator">></span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment" spellcheck="true">//添加，并运算</span>
<span class="token function">removeAll</span><span class="token punctuation">(</span>Collection<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token keyword">extends</span> <span class="token class-name">E</span><span class="token operator">></span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">//移除，减运算</span></code></pre>
<hr>
<h1 id="LinkedList"><a href="#LinkedList" class="headerlink" title="LinkedList"></a>LinkedList</h1><p>LinkedList是基于双向循环链表实现的，除了可以当作链表来操作外，它还可以当作栈、队列和双端队列来使用。</p>
<p>非线程安全，单线程下使用</p>
<p>LinkedList实现了Serializable接口，因此它支持序列化，能够通过序列化传输，实现了Cloneable接口，能被克隆。</p>
<ul>
<li>是一个类</li>
<li>实现的接口：List、Collection、Iterable、Serializable、Cloneable、Deque，Queue</li>
<li>子类：没有子类</li>
</ul>
<p>添加元素方法：</p>
<p><strong>boolean add(E e)</strong> 添加到链表末尾</p>
<p><strong>void add(int index, E e)</strong> 添加到指定位置</p>
<p><strong>boolean addAll(int index, Collection&lt;? extends E&gt; c)</strong></p>
<p><strong>boolean addAll(Collection&lt;? extends E&gt; c)</strong></p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> java<span class="token punctuation">.</span>util<span class="token punctuation">;</span>    

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LinkedList</span><span class="token operator">&lt;</span>E<span class="token operator">></span>    
    <span class="token keyword">extends</span> <span class="token class-name">AbstractSequentialList</span><span class="token operator">&lt;</span>E<span class="token operator">></span>    
    <span class="token keyword">implements</span> <span class="token class-name">List</span><span class="token operator">&lt;</span>E<span class="token operator">></span><span class="token punctuation">,</span> Deque<span class="token operator">&lt;</span>E<span class="token operator">></span><span class="token punctuation">,</span> Cloneable<span class="token punctuation">,</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>Serializable    
<span class="token punctuation">{</span>    
    <span class="token comment" spellcheck="true">// 链表的表头，表头不包含任何数据。Entry是个链表类数据结构。    </span>
    <span class="token keyword">private</span> <span class="token keyword">transient</span> Entry<span class="token operator">&lt;</span>E<span class="token operator">></span> header <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Entry</span><span class="token operator">&lt;</span>E<span class="token operator">></span><span class="token punctuation">(</span>null<span class="token punctuation">,</span> null<span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span>    

    <span class="token comment" spellcheck="true">// LinkedList中元素个数    </span>
    <span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token keyword">int</span> size <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    

    <span class="token comment" spellcheck="true">// 默认构造函数：创建一个空的链表    </span>
    <span class="token keyword">public</span> <span class="token function">LinkedList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        header<span class="token punctuation">.</span>next <span class="token operator">=</span> header<span class="token punctuation">.</span>previous <span class="token operator">=</span> header<span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 包含“集合”的构造函数:创建一个包含“集合”的LinkedList    </span>
    <span class="token keyword">public</span> <span class="token function">LinkedList</span><span class="token punctuation">(</span>Collection<span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">E</span><span class="token operator">></span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">this</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token function">addAll</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 获取LinkedList的第一个元素    </span>
    <span class="token keyword">public</span> E <span class="token function">getFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">if</span> <span class="token punctuation">(</span>size<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>    
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NoSuchElementException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    

        <span class="token comment" spellcheck="true">// 链表的表头header中不包含数据。    </span>
        <span class="token comment" spellcheck="true">// 这里返回header所指下一个节点所包含的数据。    </span>
        <span class="token keyword">return</span> header<span class="token punctuation">.</span>next<span class="token punctuation">.</span>element<span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 获取LinkedList的最后一个元素    </span>
    <span class="token keyword">public</span> E <span class="token function">getLast</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>    
        <span class="token keyword">if</span> <span class="token punctuation">(</span>size<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>    
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NoSuchElementException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    

        <span class="token comment" spellcheck="true">// 由于LinkedList是双向链表；而表头header不包含数据。    </span>
        <span class="token comment" spellcheck="true">// 因而，这里返回表头header的前一个节点所包含的数据。    </span>
        <span class="token keyword">return</span> header<span class="token punctuation">.</span>previous<span class="token punctuation">.</span>element<span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 删除LinkedList的第一个元素    </span>
    <span class="token keyword">public</span> E <span class="token function">removeFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">return</span> <span class="token function">remove</span><span class="token punctuation">(</span>header<span class="token punctuation">.</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 删除LinkedList的最后一个元素    </span>
    <span class="token keyword">public</span> E <span class="token function">removeLast</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">return</span> <span class="token function">remove</span><span class="token punctuation">(</span>header<span class="token punctuation">.</span>previous<span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 将元素添加到LinkedList的起始位置    </span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addFirst</span><span class="token punctuation">(</span>E e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token function">addBefore</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> header<span class="token punctuation">.</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 将元素添加到LinkedList的结束位置    </span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addLast</span><span class="token punctuation">(</span>E e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token function">addBefore</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> header<span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 判断LinkedList是否包含元素(o)    </span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">contains</span><span class="token punctuation">(</span>Object o<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">return</span> <span class="token function">indexOf</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 返回LinkedList的大小    </span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">return</span> size<span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 将元素(E)添加到LinkedList中    </span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">add</span><span class="token punctuation">(</span>E e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token comment" spellcheck="true">// 将节点(节点数据是e)添加到表头(header)之前。    </span>
        <span class="token comment" spellcheck="true">// 即，将节点添加到双向链表的末端。    </span>
        <span class="token function">addBefore</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> header<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 从LinkedList中删除元素(o)    </span>
    <span class="token comment" spellcheck="true">// 从链表开始查找，如存在元素(o)则删除该元素并返回true；    </span>
    <span class="token comment" spellcheck="true">// 否则，返回false。    </span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">remove</span><span class="token punctuation">(</span>Object o<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">if</span> <span class="token punctuation">(</span>o<span class="token operator">==</span>null<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token comment" spellcheck="true">// 若o为null的删除情况    </span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>Entry<span class="token operator">&lt;</span>E<span class="token operator">></span> e <span class="token operator">=</span> header<span class="token punctuation">.</span>next<span class="token punctuation">;</span> e <span class="token operator">!=</span> header<span class="token punctuation">;</span> e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
                <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>element<span class="token operator">==</span>null<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
                    <span class="token function">remove</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    
                    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    
                <span class="token punctuation">}</span>    
            <span class="token punctuation">}</span>    
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    
            <span class="token comment" spellcheck="true">// 若o不为null的删除情况    </span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>Entry<span class="token operator">&lt;</span>E<span class="token operator">></span> e <span class="token operator">=</span> header<span class="token punctuation">.</span>next<span class="token punctuation">;</span> e <span class="token operator">!=</span> header<span class="token punctuation">;</span> e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
                <span class="token keyword">if</span> <span class="token punctuation">(</span>o<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>element<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
                    <span class="token function">remove</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    
                    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    
                <span class="token punctuation">}</span>    
            <span class="token punctuation">}</span>    
        <span class="token punctuation">}</span>    
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 将“集合(c)”添加到LinkedList中。    </span>
    <span class="token comment" spellcheck="true">// 实际上，是从双向链表的末尾开始，将“集合(c)”添加到双向链表中。    </span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">addAll</span><span class="token punctuation">(</span>Collection<span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">E</span><span class="token operator">></span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">return</span> <span class="token function">addAll</span><span class="token punctuation">(</span>size<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 从双向链表的index开始，将“集合(c)”添加到双向链表中。    </span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">addAll</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">,</span> Collection<span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">E</span><span class="token operator">></span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> index <span class="token operator">></span> size<span class="token punctuation">)</span>    
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IndexOutOfBoundsException</span><span class="token punctuation">(</span><span class="token string">"Index: "</span><span class="token operator">+</span>index<span class="token operator">+</span>    
                                                <span class="token string">", Size: "</span><span class="token operator">+</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        Object<span class="token punctuation">[</span><span class="token punctuation">]</span> a <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token comment" spellcheck="true">// 获取集合的长度    </span>
        <span class="token keyword">int</span> numNew <span class="token operator">=</span> a<span class="token punctuation">.</span>length<span class="token punctuation">;</span>    
        <span class="token keyword">if</span> <span class="token punctuation">(</span>numNew<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>    
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    
        modCount<span class="token operator">++</span><span class="token punctuation">;</span>    

        <span class="token comment" spellcheck="true">// 设置“当前要插入节点的后一个节点”    </span>
        Entry<span class="token operator">&lt;</span>E<span class="token operator">></span> successor <span class="token operator">=</span> <span class="token punctuation">(</span>index<span class="token operator">==</span>size <span class="token operator">?</span> header <span class="token operator">:</span> <span class="token function">entry</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token comment" spellcheck="true">// 设置“当前要插入节点的前一个节点”    </span>
        Entry<span class="token operator">&lt;</span>E<span class="token operator">></span> predecessor <span class="token operator">=</span> successor<span class="token punctuation">.</span>previous<span class="token punctuation">;</span>    
        <span class="token comment" spellcheck="true">// 将集合(c)全部插入双向链表中    </span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>numNew<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            Entry<span class="token operator">&lt;</span>E<span class="token operator">></span> e <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Entry</span><span class="token operator">&lt;</span>E<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">(</span>E<span class="token punctuation">)</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> successor<span class="token punctuation">,</span> predecessor<span class="token punctuation">)</span><span class="token punctuation">;</span>    
            predecessor<span class="token punctuation">.</span>next <span class="token operator">=</span> e<span class="token punctuation">;</span>    
            predecessor <span class="token operator">=</span> e<span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    
        successor<span class="token punctuation">.</span>previous <span class="token operator">=</span> predecessor<span class="token punctuation">;</span>    

        <span class="token comment" spellcheck="true">// 调整LinkedList的实际大小    </span>
        size <span class="token operator">+=</span> numNew<span class="token punctuation">;</span>    
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 清空双向链表    </span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        Entry<span class="token operator">&lt;</span>E<span class="token operator">></span> e <span class="token operator">=</span> header<span class="token punctuation">.</span>next<span class="token punctuation">;</span>    
        <span class="token comment" spellcheck="true">// 从表头开始，逐个向后遍历；对遍历到的节点执行一下操作：    </span>
        <span class="token comment" spellcheck="true">// (01) 设置前一个节点为null     </span>
        <span class="token comment" spellcheck="true">// (02) 设置当前节点的内容为null     </span>
        <span class="token comment" spellcheck="true">// (03) 设置后一个节点为“新的当前节点”    </span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> header<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            Entry<span class="token operator">&lt;</span>E<span class="token operator">></span> next <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">;</span>    
            e<span class="token punctuation">.</span>next <span class="token operator">=</span> e<span class="token punctuation">.</span>previous <span class="token operator">=</span> null<span class="token punctuation">;</span>    
            e<span class="token punctuation">.</span>element <span class="token operator">=</span> null<span class="token punctuation">;</span>    
            e <span class="token operator">=</span> next<span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    
        header<span class="token punctuation">.</span>next <span class="token operator">=</span> header<span class="token punctuation">.</span>previous <span class="token operator">=</span> header<span class="token punctuation">;</span>    
        <span class="token comment" spellcheck="true">// 设置大小为0    </span>
        size <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    
        modCount<span class="token operator">++</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 返回LinkedList指定位置的元素    </span>
    <span class="token keyword">public</span> E <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">return</span> <span class="token function">entry</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>element<span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 设置index位置对应的节点的值为element    </span>
    <span class="token keyword">public</span> E <span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">,</span> E element<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        Entry<span class="token operator">&lt;</span>E<span class="token operator">></span> e <span class="token operator">=</span> <span class="token function">entry</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        E oldVal <span class="token operator">=</span> e<span class="token punctuation">.</span>element<span class="token punctuation">;</span>    
        e<span class="token punctuation">.</span>element <span class="token operator">=</span> element<span class="token punctuation">;</span>    
        <span class="token keyword">return</span> oldVal<span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 在index前添加节点，且节点的值为element    </span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">,</span> E element<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token function">addBefore</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> <span class="token punctuation">(</span>index<span class="token operator">==</span>size <span class="token operator">?</span> header <span class="token operator">:</span> <span class="token function">entry</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 删除index位置的节点    </span>
    <span class="token keyword">public</span> E <span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">return</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token function">entry</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 获取双向链表中指定位置的节点    </span>
    <span class="token keyword">private</span> Entry<span class="token operator">&lt;</span>E<span class="token operator">></span> <span class="token function">entry</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> index <span class="token operator">>=</span> size<span class="token punctuation">)</span>    
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IndexOutOfBoundsException</span><span class="token punctuation">(</span><span class="token string">"Index: "</span><span class="token operator">+</span>index<span class="token operator">+</span>    
                                                <span class="token string">", Size: "</span><span class="token operator">+</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        Entry<span class="token operator">&lt;</span>E<span class="token operator">></span> e <span class="token operator">=</span> header<span class="token punctuation">;</span>    
        <span class="token comment" spellcheck="true">// 获取index处的节点。    </span>
        <span class="token comment" spellcheck="true">// 若index &lt; 双向链表长度的1/2,则从前先后查找;    </span>
        <span class="token comment" spellcheck="true">// 否则，从后向前查找。    </span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> <span class="token punctuation">(</span>size <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> index<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>    
                e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">;</span>    
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> size<span class="token punctuation">;</span> i <span class="token operator">></span> index<span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span>    
                e <span class="token operator">=</span> e<span class="token punctuation">.</span>previous<span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    
        <span class="token keyword">return</span> e<span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 从前向后查找，返回“值为对象(o)的节点对应的索引”    </span>
    <span class="token comment" spellcheck="true">// 不存在就返回-1    </span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">indexOf</span><span class="token punctuation">(</span>Object o<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    
        <span class="token keyword">if</span> <span class="token punctuation">(</span>o<span class="token operator">==</span>null<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">for</span> <span class="token punctuation">(</span>Entry e <span class="token operator">=</span> header<span class="token punctuation">.</span>next<span class="token punctuation">;</span> e <span class="token operator">!=</span> header<span class="token punctuation">;</span> e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
                <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>element<span class="token operator">==</span>null<span class="token punctuation">)</span>    
                    <span class="token keyword">return</span> index<span class="token punctuation">;</span>    
                index<span class="token operator">++</span><span class="token punctuation">;</span>    
            <span class="token punctuation">}</span>    
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    
            <span class="token keyword">for</span> <span class="token punctuation">(</span>Entry e <span class="token operator">=</span> header<span class="token punctuation">.</span>next<span class="token punctuation">;</span> e <span class="token operator">!=</span> header<span class="token punctuation">;</span> e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
                <span class="token keyword">if</span> <span class="token punctuation">(</span>o<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>element<span class="token punctuation">)</span><span class="token punctuation">)</span>    
                    <span class="token keyword">return</span> index<span class="token punctuation">;</span>    
                index<span class="token operator">++</span><span class="token punctuation">;</span>    
            <span class="token punctuation">}</span>    
        <span class="token punctuation">}</span>    
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 从后向前查找，返回“值为对象(o)的节点对应的索引”    </span>
    <span class="token comment" spellcheck="true">// 不存在就返回-1    </span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">lastIndexOf</span><span class="token punctuation">(</span>Object o<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">int</span> index <span class="token operator">=</span> size<span class="token punctuation">;</span>    
        <span class="token keyword">if</span> <span class="token punctuation">(</span>o<span class="token operator">==</span>null<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">for</span> <span class="token punctuation">(</span>Entry e <span class="token operator">=</span> header<span class="token punctuation">.</span>previous<span class="token punctuation">;</span> e <span class="token operator">!=</span> header<span class="token punctuation">;</span> e <span class="token operator">=</span> e<span class="token punctuation">.</span>previous<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
                index<span class="token operator">--</span><span class="token punctuation">;</span>    
                <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>element<span class="token operator">==</span>null<span class="token punctuation">)</span>    
                    <span class="token keyword">return</span> index<span class="token punctuation">;</span>    
            <span class="token punctuation">}</span>    
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    
            <span class="token keyword">for</span> <span class="token punctuation">(</span>Entry e <span class="token operator">=</span> header<span class="token punctuation">.</span>previous<span class="token punctuation">;</span> e <span class="token operator">!=</span> header<span class="token punctuation">;</span> e <span class="token operator">=</span> e<span class="token punctuation">.</span>previous<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
                index<span class="token operator">--</span><span class="token punctuation">;</span>    
                <span class="token keyword">if</span> <span class="token punctuation">(</span>o<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>element<span class="token punctuation">)</span><span class="token punctuation">)</span>    
                    <span class="token keyword">return</span> index<span class="token punctuation">;</span>    
            <span class="token punctuation">}</span>    
        <span class="token punctuation">}</span>    
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 返回第一个节点    </span>
    <span class="token comment" spellcheck="true">// 若LinkedList的大小为0,则返回null    </span>
    <span class="token keyword">public</span> E <span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">if</span> <span class="token punctuation">(</span>size<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>    
            <span class="token keyword">return</span> null<span class="token punctuation">;</span>    
        <span class="token keyword">return</span> <span class="token function">getFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 返回第一个节点    </span>
    <span class="token comment" spellcheck="true">// 若LinkedList的大小为0,则抛出异常    </span>
    <span class="token keyword">public</span> E <span class="token function">element</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">return</span> <span class="token function">getFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 删除并返回第一个节点    </span>
    <span class="token comment" spellcheck="true">// 若LinkedList的大小为0,则返回null    </span>
    <span class="token keyword">public</span> E <span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">if</span> <span class="token punctuation">(</span>size<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>    
            <span class="token keyword">return</span> null<span class="token punctuation">;</span>    
        <span class="token keyword">return</span> <span class="token function">removeFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 将e添加双向链表末尾    </span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">offer</span><span class="token punctuation">(</span>E e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">return</span> <span class="token function">add</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 将e添加双向链表开头    </span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">offerFirst</span><span class="token punctuation">(</span>E e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token function">addFirst</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 将e添加双向链表末尾    </span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">offerLast</span><span class="token punctuation">(</span>E e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token function">addLast</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 返回第一个节点    </span>
    <span class="token comment" spellcheck="true">// 若LinkedList的大小为0,则返回null    </span>
    <span class="token keyword">public</span> E <span class="token function">peekFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">if</span> <span class="token punctuation">(</span>size<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>    
            <span class="token keyword">return</span> null<span class="token punctuation">;</span>    
        <span class="token keyword">return</span> <span class="token function">getFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 返回最后一个节点    </span>
    <span class="token comment" spellcheck="true">// 若LinkedList的大小为0,则返回null    </span>
    <span class="token keyword">public</span> E <span class="token function">peekLast</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">if</span> <span class="token punctuation">(</span>size<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>    
            <span class="token keyword">return</span> null<span class="token punctuation">;</span>    
        <span class="token keyword">return</span> <span class="token function">getLast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 删除并返回第一个节点    </span>
    <span class="token comment" spellcheck="true">// 若LinkedList的大小为0,则返回null    </span>
    <span class="token keyword">public</span> E <span class="token function">pollFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">if</span> <span class="token punctuation">(</span>size<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>    
            <span class="token keyword">return</span> null<span class="token punctuation">;</span>    
        <span class="token keyword">return</span> <span class="token function">removeFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 删除并返回最后一个节点    </span>
    <span class="token comment" spellcheck="true">// 若LinkedList的大小为0,则返回null    </span>
    <span class="token keyword">public</span> E <span class="token function">pollLast</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">if</span> <span class="token punctuation">(</span>size<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>    
            <span class="token keyword">return</span> null<span class="token punctuation">;</span>    
        <span class="token keyword">return</span> <span class="token function">removeLast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 将e插入到双向链表开头    </span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">push</span><span class="token punctuation">(</span>E e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token function">addFirst</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 删除并返回第一个节点    </span>
    <span class="token keyword">public</span> E <span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">return</span> <span class="token function">removeFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 从LinkedList开始向后查找，删除第一个值为元素(o)的节点    </span>
    <span class="token comment" spellcheck="true">// 从链表开始查找，如存在节点的值为元素(o)的节点，则删除该节点    </span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">removeFirstOccurrence</span><span class="token punctuation">(</span>Object o<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">return</span> <span class="token function">remove</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 从LinkedList末尾向前查找，删除第一个值为元素(o)的节点    </span>
    <span class="token comment" spellcheck="true">// 从链表开始查找，如存在节点的值为元素(o)的节点，则删除该节点    </span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">removeLastOccurrence</span><span class="token punctuation">(</span>Object o<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">if</span> <span class="token punctuation">(</span>o<span class="token operator">==</span>null<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">for</span> <span class="token punctuation">(</span>Entry<span class="token operator">&lt;</span>E<span class="token operator">></span> e <span class="token operator">=</span> header<span class="token punctuation">.</span>previous<span class="token punctuation">;</span> e <span class="token operator">!=</span> header<span class="token punctuation">;</span> e <span class="token operator">=</span> e<span class="token punctuation">.</span>previous<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
                <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>element<span class="token operator">==</span>null<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
                    <span class="token function">remove</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    
                    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    
                <span class="token punctuation">}</span>    
            <span class="token punctuation">}</span>    
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    
            <span class="token keyword">for</span> <span class="token punctuation">(</span>Entry<span class="token operator">&lt;</span>E<span class="token operator">></span> e <span class="token operator">=</span> header<span class="token punctuation">.</span>previous<span class="token punctuation">;</span> e <span class="token operator">!=</span> header<span class="token punctuation">;</span> e <span class="token operator">=</span> e<span class="token punctuation">.</span>previous<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
                <span class="token keyword">if</span> <span class="token punctuation">(</span>o<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>element<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
                    <span class="token function">remove</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    
                    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    
                <span class="token punctuation">}</span>    
            <span class="token punctuation">}</span>    
        <span class="token punctuation">}</span>    
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 返回“index到末尾的全部节点”对应的ListIterator对象(List迭代器)    </span>
    <span class="token keyword">public</span> ListIterator<span class="token operator">&lt;</span>E<span class="token operator">></span> <span class="token function">listIterator</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ListItr</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// List迭代器    </span>
    <span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">ListItr</span> <span class="token keyword">implements</span> <span class="token class-name">ListIterator</span><span class="token operator">&lt;</span>E<span class="token operator">></span> <span class="token punctuation">{</span>    
        <span class="token comment" spellcheck="true">// 上一次返回的节点    </span>
        <span class="token keyword">private</span> Entry<span class="token operator">&lt;</span>E<span class="token operator">></span> lastReturned <span class="token operator">=</span> header<span class="token punctuation">;</span>    
        <span class="token comment" spellcheck="true">// 下一个节点    </span>
        <span class="token keyword">private</span> Entry<span class="token operator">&lt;</span>E<span class="token operator">></span> next<span class="token punctuation">;</span>    
        <span class="token comment" spellcheck="true">// 下一个节点对应的索引值    </span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> nextIndex<span class="token punctuation">;</span>    
        <span class="token comment" spellcheck="true">// 期望的改变计数。用来实现fail-fast机制。    </span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> expectedModCount <span class="token operator">=</span> modCount<span class="token punctuation">;</span>    

        <span class="token comment" spellcheck="true">// 构造函数。    </span>
        <span class="token comment" spellcheck="true">// 从index位置开始进行迭代    </span>
        <span class="token function">ListItr</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token comment" spellcheck="true">// index的有效性处理    </span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> index <span class="token operator">></span> size<span class="token punctuation">)</span>    
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IndexOutOfBoundsException</span><span class="token punctuation">(</span><span class="token string">"Index: "</span><span class="token operator">+</span>index<span class="token operator">+</span> <span class="token string">", Size: "</span><span class="token operator">+</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>    
            <span class="token comment" spellcheck="true">// 若 “index 小于 ‘双向链表长度的一半’”，则从第一个元素开始往后查找；    </span>
            <span class="token comment" spellcheck="true">// 否则，从最后一个元素往前查找。    </span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> <span class="token punctuation">(</span>size <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
                next <span class="token operator">=</span> header<span class="token punctuation">.</span>next<span class="token punctuation">;</span>    
                <span class="token keyword">for</span> <span class="token punctuation">(</span>nextIndex<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> nextIndex<span class="token operator">&lt;</span>index<span class="token punctuation">;</span> nextIndex<span class="token operator">++</span><span class="token punctuation">)</span>    
                    next <span class="token operator">=</span> next<span class="token punctuation">.</span>next<span class="token punctuation">;</span>    
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    
                next <span class="token operator">=</span> header<span class="token punctuation">;</span>    
                <span class="token keyword">for</span> <span class="token punctuation">(</span>nextIndex<span class="token operator">=</span>size<span class="token punctuation">;</span> nextIndex<span class="token operator">></span>index<span class="token punctuation">;</span> nextIndex<span class="token operator">--</span><span class="token punctuation">)</span>    
                    next <span class="token operator">=</span> next<span class="token punctuation">.</span>previous<span class="token punctuation">;</span>    
            <span class="token punctuation">}</span>    
        <span class="token punctuation">}</span>    

        <span class="token comment" spellcheck="true">// 是否存在下一个元素    </span>
        <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token comment" spellcheck="true">// 通过元素索引是否等于“双向链表大小”来判断是否达到最后。    </span>
            <span class="token keyword">return</span> nextIndex <span class="token operator">!=</span> size<span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    

        <span class="token comment" spellcheck="true">// 获取下一个元素    </span>
        <span class="token keyword">public</span> E <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token function">checkForComodification</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
            <span class="token keyword">if</span> <span class="token punctuation">(</span>nextIndex <span class="token operator">==</span> size<span class="token punctuation">)</span>    
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NoSuchElementException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    

            lastReturned <span class="token operator">=</span> next<span class="token punctuation">;</span>    
            <span class="token comment" spellcheck="true">// next指向链表的下一个元素    </span>
            next <span class="token operator">=</span> next<span class="token punctuation">.</span>next<span class="token punctuation">;</span>    
            nextIndex<span class="token operator">++</span><span class="token punctuation">;</span>    
            <span class="token keyword">return</span> lastReturned<span class="token punctuation">.</span>element<span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    

        <span class="token comment" spellcheck="true">// 是否存在上一个元素    </span>
        <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hasPrevious</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token comment" spellcheck="true">// 通过元素索引是否等于0，来判断是否达到开头。    </span>
            <span class="token keyword">return</span> nextIndex <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    

        <span class="token comment" spellcheck="true">// 获取上一个元素    </span>
        <span class="token keyword">public</span> E <span class="token function">previous</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">if</span> <span class="token punctuation">(</span>nextIndex <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>    
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NoSuchElementException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    

            <span class="token comment" spellcheck="true">// next指向链表的上一个元素    </span>
            lastReturned <span class="token operator">=</span> next <span class="token operator">=</span> next<span class="token punctuation">.</span>previous<span class="token punctuation">;</span>    
            nextIndex<span class="token operator">--</span><span class="token punctuation">;</span>    
            <span class="token function">checkForComodification</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
            <span class="token keyword">return</span> lastReturned<span class="token punctuation">.</span>element<span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    

        <span class="token comment" spellcheck="true">// 获取下一个元素的索引    </span>
        <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">nextIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">return</span> nextIndex<span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    

        <span class="token comment" spellcheck="true">// 获取上一个元素的索引    </span>
        <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">previousIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">return</span> nextIndex<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    

        <span class="token comment" spellcheck="true">// 删除当前元素。    </span>
        <span class="token comment" spellcheck="true">// 删除双向链表中的当前节点    </span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token function">checkForComodification</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
            Entry<span class="token operator">&lt;</span>E<span class="token operator">></span> lastNext <span class="token operator">=</span> lastReturned<span class="token punctuation">.</span>next<span class="token punctuation">;</span>    
            <span class="token keyword">try</span> <span class="token punctuation">{</span>    
                LinkedList<span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>lastReturned<span class="token punctuation">)</span><span class="token punctuation">;</span>    
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchElementException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
            <span class="token punctuation">}</span>    
            <span class="token keyword">if</span> <span class="token punctuation">(</span>next<span class="token operator">==</span>lastReturned<span class="token punctuation">)</span>    
                next <span class="token operator">=</span> lastNext<span class="token punctuation">;</span>    
            <span class="token keyword">else</span>   
                nextIndex<span class="token operator">--</span><span class="token punctuation">;</span>    
            lastReturned <span class="token operator">=</span> header<span class="token punctuation">;</span>    
            expectedModCount<span class="token operator">++</span><span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    

        <span class="token comment" spellcheck="true">// 设置当前节点为e    </span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span>E e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">if</span> <span class="token punctuation">(</span>lastReturned <span class="token operator">==</span> header<span class="token punctuation">)</span>    
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
            <span class="token function">checkForComodification</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
            lastReturned<span class="token punctuation">.</span>element <span class="token operator">=</span> e<span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    

        <span class="token comment" spellcheck="true">// 将e添加到当前节点的前面    </span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span>E e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token function">checkForComodification</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
            lastReturned <span class="token operator">=</span> header<span class="token punctuation">;</span>    
            <span class="token function">addBefore</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">;</span>    
            nextIndex<span class="token operator">++</span><span class="token punctuation">;</span>    
            expectedModCount<span class="token operator">++</span><span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    

        <span class="token comment" spellcheck="true">// 判断 “modCount和expectedModCount是否相等”，依次来实现fail-fast机制。    </span>
        <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">checkForComodification</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">if</span> <span class="token punctuation">(</span>modCount <span class="token operator">!=</span> expectedModCount<span class="token punctuation">)</span>    
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentModificationException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 双向链表的节点所对应的数据结构。    </span>
    <span class="token comment" spellcheck="true">// 包含3部分：上一节点，下一节点，当前节点值。    </span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Entry</span><span class="token operator">&lt;</span>E<span class="token operator">></span> <span class="token punctuation">{</span>    
        <span class="token comment" spellcheck="true">// 当前节点所包含的值    </span>
        E element<span class="token punctuation">;</span>    
        <span class="token comment" spellcheck="true">// 下一个节点    </span>
        Entry<span class="token operator">&lt;</span>E<span class="token operator">></span> next<span class="token punctuation">;</span>    
        <span class="token comment" spellcheck="true">// 上一个节点    </span>
        Entry<span class="token operator">&lt;</span>E<span class="token operator">></span> previous<span class="token punctuation">;</span>    

        <span class="token comment" spellcheck="true">/**   
         * 链表节点的构造函数。   
         * 参数说明：   
         *   element  —— 节点所包含的数据   
         *   next      —— 下一个节点   
         *   previous —— 上一个节点   
         */</span>   
        <span class="token function">Entry</span><span class="token punctuation">(</span>E element<span class="token punctuation">,</span> Entry<span class="token operator">&lt;</span>E<span class="token operator">></span> next<span class="token punctuation">,</span> Entry<span class="token operator">&lt;</span>E<span class="token operator">></span> previous<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">this</span><span class="token punctuation">.</span>element <span class="token operator">=</span> element<span class="token punctuation">;</span>    
            <span class="token keyword">this</span><span class="token punctuation">.</span>next <span class="token operator">=</span> next<span class="token punctuation">;</span>    
            <span class="token keyword">this</span><span class="token punctuation">.</span>previous <span class="token operator">=</span> previous<span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 将节点(节点数据是e)添加到entry节点之前。    </span>
    <span class="token keyword">private</span> Entry<span class="token operator">&lt;</span>E<span class="token operator">></span> <span class="token function">addBefore</span><span class="token punctuation">(</span>E e<span class="token punctuation">,</span> Entry<span class="token operator">&lt;</span>E<span class="token operator">></span> entry<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token comment" spellcheck="true">// 新建节点newEntry，将newEntry插入到节点e之前；并且设置newEntry的数据是e    </span>
        Entry<span class="token operator">&lt;</span>E<span class="token operator">></span> newEntry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Entry</span><span class="token operator">&lt;</span>E<span class="token operator">></span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> entry<span class="token punctuation">,</span> entry<span class="token punctuation">.</span>previous<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        newEntry<span class="token punctuation">.</span>previous<span class="token punctuation">.</span>next <span class="token operator">=</span> newEntry<span class="token punctuation">;</span>    
        newEntry<span class="token punctuation">.</span>next<span class="token punctuation">.</span>previous <span class="token operator">=</span> newEntry<span class="token punctuation">;</span>    
        <span class="token comment" spellcheck="true">// 修改LinkedList大小    </span>
        size<span class="token operator">++</span><span class="token punctuation">;</span>    
        <span class="token comment" spellcheck="true">// 修改LinkedList的修改统计数：用来实现fail-fast机制。    </span>
        modCount<span class="token operator">++</span><span class="token punctuation">;</span>    
        <span class="token keyword">return</span> newEntry<span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 将节点从链表中删除    </span>
    <span class="token keyword">private</span> E <span class="token function">remove</span><span class="token punctuation">(</span>Entry<span class="token operator">&lt;</span>E<span class="token operator">></span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">==</span> header<span class="token punctuation">)</span>    
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NoSuchElementException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    

        E result <span class="token operator">=</span> e<span class="token punctuation">.</span>element<span class="token punctuation">;</span>    
        e<span class="token punctuation">.</span>previous<span class="token punctuation">.</span>next <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">;</span>    
        e<span class="token punctuation">.</span>next<span class="token punctuation">.</span>previous <span class="token operator">=</span> e<span class="token punctuation">.</span>previous<span class="token punctuation">;</span>    
        e<span class="token punctuation">.</span>next <span class="token operator">=</span> e<span class="token punctuation">.</span>previous <span class="token operator">=</span> null<span class="token punctuation">;</span>    
        e<span class="token punctuation">.</span>element <span class="token operator">=</span> null<span class="token punctuation">;</span>    
        size<span class="token operator">--</span><span class="token punctuation">;</span>    
        modCount<span class="token operator">++</span><span class="token punctuation">;</span>    
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 反向迭代器    </span>
    <span class="token keyword">public</span> Iterator<span class="token operator">&lt;</span>E<span class="token operator">></span> <span class="token function">descendingIterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DescendingIterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 反向迭代器实现类。    </span>
    <span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">DescendingIterator</span> <span class="token keyword">implements</span> <span class="token class-name">Iterator</span> <span class="token punctuation">{</span>    
        <span class="token keyword">final</span> ListItr itr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ListItr</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token comment" spellcheck="true">// 反向迭代器是否下一个元素。    </span>
        <span class="token comment" spellcheck="true">// 实际上是判断双向链表的当前节点是否达到开头    </span>
        <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">return</span> itr<span class="token punctuation">.</span><span class="token function">hasPrevious</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    
        <span class="token comment" spellcheck="true">// 反向迭代器获取下一个元素。    </span>
        <span class="token comment" spellcheck="true">// 实际上是获取双向链表的前一个节点    </span>
        <span class="token keyword">public</span> E <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">return</span> itr<span class="token punctuation">.</span><span class="token function">previous</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    
        <span class="token comment" spellcheck="true">// 删除当前节点    </span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            itr<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    
    <span class="token punctuation">}</span>    


    <span class="token comment" spellcheck="true">// 返回LinkedList的Object[]数组    </span>
    <span class="token keyword">public</span> Object<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
    <span class="token comment" spellcheck="true">// 新建Object[]数组    </span>
    Object<span class="token punctuation">[</span><span class="token punctuation">]</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token punctuation">;</span>    
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    
        <span class="token comment" spellcheck="true">// 将链表中所有节点的数据都添加到Object[]数组中    </span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>Entry<span class="token operator">&lt;</span>E<span class="token operator">></span> e <span class="token operator">=</span> header<span class="token punctuation">.</span>next<span class="token punctuation">;</span> e <span class="token operator">!=</span> header<span class="token punctuation">;</span> e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span>    
            result<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">.</span>element<span class="token punctuation">;</span>    
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// 返回LinkedList的模板数组。所谓模板数组，即可以将T设为任意的数据类型    </span>
    <span class="token keyword">public</span> <span class="token operator">&lt;</span>T<span class="token operator">></span> T<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">toArray</span><span class="token punctuation">(</span>T<span class="token punctuation">[</span><span class="token punctuation">]</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token comment" spellcheck="true">// 若数组a的大小 &lt; LinkedList的元素个数(意味着数组a不能容纳LinkedList中全部元素)    </span>
        <span class="token comment" spellcheck="true">// 则新建一个T[]数组，T[]的大小为LinkedList大小，并将该T[]赋值给a。    </span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> size<span class="token punctuation">)</span>    
            a <span class="token operator">=</span> <span class="token punctuation">(</span>T<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>Array<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span>    
                                a<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getComponentType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token comment" spellcheck="true">// 将链表中所有节点的数据都添加到数组a中    </span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    
        Object<span class="token punctuation">[</span><span class="token punctuation">]</span> result <span class="token operator">=</span> a<span class="token punctuation">;</span>    
        <span class="token keyword">for</span> <span class="token punctuation">(</span>Entry<span class="token operator">&lt;</span>E<span class="token operator">></span> e <span class="token operator">=</span> header<span class="token punctuation">.</span>next<span class="token punctuation">;</span> e <span class="token operator">!=</span> header<span class="token punctuation">;</span> e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span>    
            result<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">.</span>element<span class="token punctuation">;</span>    

        <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>length <span class="token operator">></span> size<span class="token punctuation">)</span>    
            a<span class="token punctuation">[</span>size<span class="token punctuation">]</span> <span class="token operator">=</span> null<span class="token punctuation">;</span>    

        <span class="token keyword">return</span> a<span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    


    <span class="token comment" spellcheck="true">// 克隆函数。返回LinkedList的克隆对象。    </span>
    <span class="token keyword">public</span> Object <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        LinkedList<span class="token operator">&lt;</span>E<span class="token operator">></span> clone <span class="token operator">=</span> null<span class="token punctuation">;</span>    
        <span class="token comment" spellcheck="true">// 克隆一个LinkedList克隆对象    </span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>    
            clone <span class="token operator">=</span> <span class="token punctuation">(</span>LinkedList<span class="token operator">&lt;</span>E<span class="token operator">></span><span class="token punctuation">)</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">CloneNotSupportedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">InternalError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>    

        <span class="token comment" spellcheck="true">// 新建LinkedList表头节点    </span>
        clone<span class="token punctuation">.</span>header <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Entry</span><span class="token operator">&lt;</span>E<span class="token operator">></span><span class="token punctuation">(</span>null<span class="token punctuation">,</span> null<span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        clone<span class="token punctuation">.</span>header<span class="token punctuation">.</span>next <span class="token operator">=</span> clone<span class="token punctuation">.</span>header<span class="token punctuation">.</span>previous <span class="token operator">=</span> clone<span class="token punctuation">.</span>header<span class="token punctuation">;</span>    
        clone<span class="token punctuation">.</span>size <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    
        clone<span class="token punctuation">.</span>modCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    

        <span class="token comment" spellcheck="true">// 将链表中所有节点的数据都添加到克隆对象中    </span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>Entry<span class="token operator">&lt;</span>E<span class="token operator">></span> e <span class="token operator">=</span> header<span class="token punctuation">.</span>next<span class="token punctuation">;</span> e <span class="token operator">!=</span> header<span class="token punctuation">;</span> e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span>    
            clone<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>    

        <span class="token keyword">return</span> clone<span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// java.io.Serializable的写入函数    </span>
    <span class="token comment" spellcheck="true">// 将LinkedList的“容量，所有的元素值”都写入到输出流中    </span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">writeObject</span><span class="token punctuation">(</span>java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>ObjectOutputStream s<span class="token punctuation">)</span>    
        <span class="token keyword">throws</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>IOException <span class="token punctuation">{</span>    
        <span class="token comment" spellcheck="true">// Write out any hidden serialization magic    </span>
        s<span class="token punctuation">.</span><span class="token function">defaultWriteObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    

        <span class="token comment" spellcheck="true">// 写入“容量”    </span>
        s<span class="token punctuation">.</span><span class="token function">writeInt</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>    

        <span class="token comment" spellcheck="true">// 将链表中所有节点的数据都写入到输出流中    </span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>Entry e <span class="token operator">=</span> header<span class="token punctuation">.</span>next<span class="token punctuation">;</span> e <span class="token operator">!=</span> header<span class="token punctuation">;</span> e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span>    
            s<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    

    <span class="token comment" spellcheck="true">// java.io.Serializable的读取函数：根据写入方式反向读出    </span>
    <span class="token comment" spellcheck="true">// 先将LinkedList的“容量”读出，然后将“所有的元素值”读出    </span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">readObject</span><span class="token punctuation">(</span>java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>ObjectInputStream s<span class="token punctuation">)</span>    
        <span class="token keyword">throws</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>IOException<span class="token punctuation">,</span> ClassNotFoundException <span class="token punctuation">{</span>    
        <span class="token comment" spellcheck="true">// Read in any hidden serialization magic    </span>
        s<span class="token punctuation">.</span><span class="token function">defaultReadObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    

        <span class="token comment" spellcheck="true">// 从输入流中读取“容量”    </span>
        <span class="token keyword">int</span> size <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    

        <span class="token comment" spellcheck="true">// 新建链表表头节点    </span>
        header <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Entry</span><span class="token operator">&lt;</span>E<span class="token operator">></span><span class="token punctuation">(</span>null<span class="token punctuation">,</span> null<span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        header<span class="token punctuation">.</span>next <span class="token operator">=</span> header<span class="token punctuation">.</span>previous <span class="token operator">=</span> header<span class="token punctuation">;</span>    

        <span class="token comment" spellcheck="true">// 从输入流中将“所有的元素值”并逐个添加到链表中    </span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>    
            <span class="token function">addBefore</span><span class="token punctuation">(</span><span class="token punctuation">(</span>E<span class="token punctuation">)</span>s<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> header<span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    
<span class="token punctuation">}</span>   </code></pre>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Java/" rel="tag"># Java</a>
              <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag"># 数据结构</a>
              <a href="/tags/%E6%BA%90%E7%A0%81/" rel="tag"># 源码</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2017/09/11/java-ji-chu-3/" rel="prev" title="Java基础-3">
      <i class="fa fa-chevron-left"></i> Java基础-3
    </a></div>
      <div class="post-nav-item">
    <a href="/2017/09/12/you-xiu-bo-zhu-zheng-li/" rel="next" title="优秀博主整理">
      优秀博主整理 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Redis"><span class="nav-number">1.</span> <span class="nav-text">Redis</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis简介"><span class="nav-number">1.1.</span> <span class="nav-text">Redis简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#字符串对象"><span class="nav-number">1.2.</span> <span class="nav-text">字符串对象</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#列表对象"><span class="nav-number">1.3.</span> <span class="nav-text">列表对象</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#哈希对象"><span class="nav-number">1.4.</span> <span class="nav-text">哈希对象</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#集合对象"><span class="nav-number">1.5.</span> <span class="nav-text">集合对象</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#有序集合对象"><span class="nav-number">1.6.</span> <span class="nav-text">有序集合对象</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ArrayList"><span class="nav-number">2.</span> <span class="nav-text">ArrayList</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#HashMap"><span class="nav-number">3.</span> <span class="nav-text">HashMap</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#HashTable"><span class="nav-number">4.</span> <span class="nav-text">HashTable</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Collection"><span class="nav-number">5.</span> <span class="nav-text">Collection</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#LinkedList"><span class="nav-number">6.</span> <span class="nav-text">LinkedList</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Damin ZHOU</p>
  <div class="site-description" itemprop="description">Goals determine <br/> what you are going to be .</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">100</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">23</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">50</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Damin ZHOU</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
